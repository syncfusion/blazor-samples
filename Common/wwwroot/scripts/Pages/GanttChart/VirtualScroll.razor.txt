@page "/gantt-chart/virtual-scroll"

@using Syncfusion.Blazor.Gantt
@using Syncfusion.Blazor.DropDowns
@using BlazorDemos.Pages.GanttChart.Data

@*Hidden:Lines*@
@inject SampleService SampleService
@implements IDisposable
@*End:Hidden*@

<ActionDescription>
    <p>
		This sample demonstrates the virtual scrolling feature in the <a class="e-gantt-virtualscroll-reference-link" aria-label="Navigate to the explore Syncfusion Blazor Gantt Chart component"
                                                                         href="https://www.syncfusion.com/blazor-components/blazor-gantt-chart"
                                                                         target="_blank" rel="noopener">Blazor Gantt Chart</a>, designed to efficiently handle
        large datasets while minimizing DOM load. Virtualization improves performance by rendering only the visible portion of tasks, 
        columns, and timeline cells based on the current viewport.
    </p>
    <p>
        In virtualization mode, all tasks are fetched from the data source initially, but only a limited number of rows and columns are rendered in the DOM. As vertical scrolling occurs, tasks are dynamically updated based on the scroll position. Similarly, the timeline is rendered up to three times the chart’s width, with additional cells loaded on demand during horizontal scrolling. Columns are also rendered dynamically as horizontal scrolling progresses.
    </p>
    <p>
        To enable virtualization:
    </p>
    <ul>
		<li>Set <a class="e-gantt-virtualscroll-reference-link" aria-label="Navigate to the EnableRowVirtualization property reference for gantt chart component" target="_blank" rel="noopener" href="https://help.syncfusion.com/cr/blazor/Syncfusion.Blazor.Gantt.SfGantt-1.html#Syncfusion_Blazor_Gantt_SfGantt_1_EnableRowVirtualization">EnableRowVirtualization</a> property to activate row level virtualization.</li>
        <li>Set <a class="e-gantt-virtualscroll-reference-link" aria-label="Navigate to the EnableTimelineVirtualization property reference for gantt chart component" target="_blank" rel="noopener" href="https://help.syncfusion.com/cr/blazor/Syncfusion.Blazor.Gantt.SfGantt-1.html#Syncfusion_Blazor_Gantt_SfGantt_1_EnableTimelineVirtualization">EnableTimelineVirtualization</a> property to enable timeline virtualization.</li>
		<li>Set <a class="e-gantt-virtualscroll-reference-link" aria-label="Navigate to the EnableColumnVirtualization property reference for gantt chart component" target="_blank" rel="noopener" href="https://help.syncfusion.com/cr/blazor/Syncfusion.Blazor.Gantt.SfGantt-1.html#Syncfusion_Blazor_Gantt_SfGantt_1_EnableColumnVirtualization">EnableColumnVirtualization</a> property to enable column virtualization.</li>
    </ul>
    <p>
		The <a class="e-gantt-virtualscroll-reference-link" aria-label="Navigate to the OverscanCount property reference for gantt chart component" target="_blank" rel="noopener" href="https://help.syncfusion.com/cr/blazor/Syncfusion.Blazor.Gantt.SfGantt-1.html#Syncfusion_Blazor_Gantt_SfGantt_1_OverscanCount">OverscanCount</a> property allows rendering of additional items before and after the visible range, reducing the frequency
        of DOM updates during scrolling. In this sample, the page size is set to 20 and the overscan count to 5, resulting in 25 records
		rendered at a time. If <a class="e-gantt-virtualscroll-reference-link" aria-label="Navigate to the PageSize property reference for gantt chart component" target="_blank" rel="noopener" href="https://help.syncfusion.com/cr/blazor/Syncfusion.Blazor.Gantt.SfGantt-1.html#Syncfusion_Blazor_Gantt_SfGantt_1_PageSize">PageSize</a> property is not defined, the number of rendered records depends on the chart’s height and viewport size, including
        the overscan buffer.
    </p>
    <p>
        The demo includes row, column, and timeline virtualization, along with support for editing actions. A dropdown list is also provided to select the number of records to load 1,000, 2,500, or 5,000 and the initial data load time is displayed in milliseconds to help evaluate performance.
    </p>
    <p>
        The toolbar provides built-in options for add, update, delete, zoom in, and zoom out operations, enabling interactive task management.
    </p>
    <p>
		For further details, refer to the <a class="e-gantt-virtualscroll-reference-link" aria-label="Navigate to the documentation for virtualization in gantt chart component" target="_blank" rel="noopener" href="https://blazor.syncfusion.com/documentation/gantt-chart/virtualization">documentation</a>.
    </p>
</ActionDescription>

<div class="control-section e-gantt-virtual-scroll-sample">
	<div style="padding-bottom: 10px;">
		<span class="e-dddata">
			<SfDropDownList TItem="DropdownData" TValue="string" PopupHeight="230px" Width="240px" @bind-Index="@Index" DataSource="@DLData" Placeholder="e.g. 1000 Rows">
				<DropDownListEvents TItem="DropdownData" TValue="string" ValueChange="OnDataChange" Closed="DropdownClose"></DropDownListEvents>
				<DropDownListFieldSettings Text="Text" Value="Value"></DropDownListFieldSettings>
			</SfDropDownList>
		</span>
		<span style="padding-left: 20px; font-size: 15px">
			<b>Data initial load time: </b> @(LoadTime.ToString() + " milliseconds")
		</span>
	</div>

	<SfGantt @ref="GanttInstance" DataSource="@TaskCollection" Height="450px" Width="100%" PageSize="20" OverscanCount="5" AutoCalculateDateScheduling="@AutoCalculateDateScheduling" TreeColumnIndex="1" EnableRowVirtualization="true"
	EnableTimelineVirtualization="true" EnableColumnVirtualization="true" ProjectStartDate="@(new DateTime(2000, 1, 1))" ProjectEndDate="@(new DateTime(2025, 12, 31))"
	Toolbar="@(new List<string>() { "Add", "Delete", "Edit", "ZoomIn", "ZoomOut" })" ScrollToTaskbarOnClick="true">
		<GanttLabelSettings LeftLabel="TaskName" TValue="VirtualScrollData.TaskData"></GanttLabelSettings>
		<GanttTaskFields ParentID="ParentId" Work="Work" Id="ID" Name="TaskName" StartDate="StartDate" EndDate="EndDate" Duration="Duration" Progress="Progress" TaskType="TaskType" Dependency="Predecessor">
		</GanttTaskFields>
		<GanttColumns>
			<GanttColumn Field="ID" HeaderText="TaskId" Width="100" TextAlign="Syncfusion.Blazor.Grids.TextAlign.Center"></GanttColumn>
			<GanttColumn Field="TaskName" HeaderText="TaskName"></GanttColumn>
			<GanttColumn Field="StartDate" HeaderText="Start Date"></GanttColumn>
			<GanttColumn Field="EndDate" HeaderText="End Date"></GanttColumn>
			<GanttColumn Field="Duration" HeaderText="Duration"></GanttColumn>
			<GanttColumn Field="Assignee" HeaderText="Assignee"></GanttColumn>
			<GanttColumn Field="Reporter" HeaderText="Reporter"></GanttColumn>
			<GanttColumn Field="Progress" HeaderText="Progress" TextAlign="Syncfusion.Blazor.Grids.TextAlign.Center"></GanttColumn>
			<GanttColumn Field="Priority" HeaderText="Priority"></GanttColumn>
			<GanttColumn Field="Status" HeaderText="Status"></GanttColumn>
			<GanttColumn Field="Work" HeaderText="Work (Hours)"></GanttColumn>
			<GanttColumn Field="TaskType" HeaderText="TaskType"></GanttColumn>
			<GanttColumn Field="Shift" HeaderText="WorkShift"></GanttColumn>
			<GanttColumn Field="StoryPoint" HeaderText="StoryPoint" TextAlign="Syncfusion.Blazor.Grids.TextAlign.Center"></GanttColumn>
			<GanttColumn Field="ActualStartDate" HeaderText="ActualStartDate" Format="@DateFormat"></GanttColumn>
			<GanttColumn Field="ActualEndDate" HeaderText="ActualEndDate" Format="@DateFormat"></GanttColumn>
			<GanttColumn Field="WorkersCount" HeaderText="Resources Count" TextAlign="Syncfusion.Blazor.Grids.TextAlign.Center"></GanttColumn>
			<GanttColumn Field="ApprovedBy" HeaderText="ApprovedBy"></GanttColumn>
			<GanttColumn Field="FixVerison" HeaderText="FixVersion" TextAlign="Syncfusion.Blazor.Grids.TextAlign.Center"></GanttColumn>
			<GanttColumn Field="PlatForm" HeaderText="PlatForm"></GanttColumn>
			<GanttColumn Field="Predecessor" HeaderText="Dependency"></GanttColumn>
		</GanttColumns>
		<GanttEditSettings AllowAdding="true" AllowDeleting="true" AllowEditing="true" Mode="EditMode.Auto" ShowDeleteConfirmDialog="true">
		</GanttEditSettings>
		<GanttSplitterSettings Position="40%"></GanttSplitterSettings>
		<GanttEvents Created="OnGanttCreated" OnActionComplete="ActionCompleteHandler" TValue="VirtualScrollData.TaskData"></GanttEvents>
	</SfGantt>
</div>
@code{
	/// <summary>
	/// Initializes the sample by loading virtual scroll data and recording the start time.
	/// </summary>
	protected override void OnInitialized()
	{
		startLoadTime = DateTime.Now;
		this.TaskCollection = VirtualScrollData.GetTreeVirtualData(1000);
		@*Hidden:Lines*@
		SampleService.TouchMousePreferenceChanged += OnTouchMousePreferenceChanged;
		@*End:Hidden*@
	}
	@*Hidden:Lines*@
	private async void OnTouchMousePreferenceChanged()
	{
		await GanttInstance.RefreshAsync();
		await GanttInstance.CallStateHasChangedAsync();
	}

	public void Dispose()
	{
		SampleService.TouchMousePreferenceChanged -= OnTouchMousePreferenceChanged;
	}
	@*End:Hidden*@
}
<style>
	.container-fluid {
		padding: 0px !important;
	}

	.e-gantt-virtual-scroll-sample {
		padding: 20px;
	}

	.e-gantt-virtualscroll-reference-link {
		text-decoration: none !important;
	}

	.e-gantt-virtualscroll-reference-link:hover,
	.e-gantt-virtualscroll-reference-link:focus {
		text-decoration: underline !important;
	}
</style>