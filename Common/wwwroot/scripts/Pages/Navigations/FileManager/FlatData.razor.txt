@page "/file-manager/flat-Data"

@using Syncfusion.Blazor.FileManager
@using BlazorDemos.Pages.FileManager
@inject NavigationManager UriHelper
@*Hidden:Lines*@
@inherits SampleBaseComponent
@*End:Hidden*@

<ActionDescription>
<p>This sample showcases the enhanced File Manager rendering capability using flat data objects, eliminating the requirement for HTTP client requests and backend URL configuration.</p>
    
    <p>The File Manager component provides comprehensive file management features including:</p>
    
    <ul>
        <li>Toolbar with essential operations</li>
        <li>Navigation pane for folder hierarchy</li>
        <li>Details view for file information</li>
        <li>Seamless file and folder navigation and selection</li>
    </ul>
    
    <p>Implementation advantages:</p>
    
    <ul>
        <li>Eliminates need for <code>FileManagerAjaxSettings</code> configuration</li>
        <li>Uses injected FileManagerService providing folder data during initial render</li>
        <li>File operations (read, delete, folder creation) executed in the service</li>
        <li>Context menu customization via <code>ContextMenuSettings API</code></li>
        <li>Custom toolbar items integration via <code>FileManagerToolbarSettings API</code></li>
    </ul>
</ActionDescription>


<div class="control-section">
    @* Initialization of default File Manager component *@
    <SfFileManager TValue="FileManagerDirectoryContent">
        <FileManagerEvents TValue="FileManagerDirectoryContent" OnRead="OnReadAsync" ItemsDeleting="ItemsDeletingAsync" FolderCreating="FolderCreatingAsync" Searching="SearchingAsync" ItemRenaming="ItemRenamingAsync" ItemsMoving="ItemsMovingAsync" BeforeImageLoad="BeforeImageLoadAsync"></FileManagerEvents>
        <FileManagerToolbarSettings ToolbarItems="@Items"></FileManagerToolbarSettings>
        <FileManagerContextMenuSettings Layout="@LayoutItems" File=@FileItems Folder=@FolderItems Visible="true"></FileManagerContextMenuSettings>
    </SfFileManager>
</div>
@code{

    public List<ToolBarItemModel> Items = new List<ToolBarItemModel>()
    {
        new ToolBarItemModel() { Name = "NewFolder" },
        new ToolBarItemModel() { Name = "Cut" },
        new ToolBarItemModel() { Name = "Copy" },
        new ToolBarItemModel() { Name = "Paste" },
        new ToolBarItemModel() { Name = "Delete" },
        new ToolBarItemModel() { Name = "Rename" },
        new ToolBarItemModel() { Name = "SortBy" },
        new ToolBarItemModel() { Name = "Refresh" },
        new ToolBarItemModel() { Name = "Selection" },
        new ToolBarItemModel() { Name = "View" },
        new ToolBarItemModel() { Name = "Details" },
    };

    public string[] LayoutItems = new string[] { "SortBy", "View", "Refresh", "|", "Paste", "|", "NewFolder", "|", "Details", "|", "SelectAll" };

    public string[] FileItems = new string[] { "Cut", "Copy", "|", "Delete", "Rename", "|", "Details" };

    public string[] FolderItems = new string[] { "Open", "|", "Cut", "Copy", "Paste", "|", "Delete", "Rename", "|", "Details"};

    public FileManagerService  FileService = new FileManagerService();

    public async Task OnReadAsync(ReadEventArgs<FileManagerDirectoryContent> args)
    {
        args.Response = await FileService.ReadAsync(args.Path, args.Folder);
    }

    public async Task ItemsDeletingAsync(ItemsDeleteEventArgs<FileManagerDirectoryContent> args)
    {
        args.Response = await FileService.DeleteAsync(args.Path, args.Files);
    }

    public async Task FolderCreatingAsync(FolderCreateEventArgs<FileManagerDirectoryContent> args)
    {
        args.Response = await FileService.CreateAsync(args.Path, args.FolderName, args.ParentFolder);
    }

    public async Task SearchingAsync(SearchEventArgs<FileManagerDirectoryContent> args)
    {
        args.Response = await FileService.SearchAsync(args.Path, args.SearchText);
    }

    public async Task ItemRenamingAsync(ItemRenameEventArgs<FileManagerDirectoryContent> args)
    {
        args.Response = await FileService.RenameAsync(args.Path, args.NewName, args.File);
    }
    public async Task ItemsMovingAsync(ItemsMoveEventArgs<FileManagerDirectoryContent> args)
    {
        if (args.IsCopy)
        {
            args.Response = await FileService.CopyAsync(args.Path, args.TargetData, args.RenameFiles, args.Files);
        }
        else{
            args.Response = await FileService.MoveAsync(args.Path, args.TargetData, args.Files);
        }
    }

    public void BeforeImageLoadAsync(BeforeImageLoadEventArgs<FileManagerDirectoryContent> args)
    {
        string relativePath = $"{SampleService?.WebAssetsPath}images/filemanager/{args.FileDetails.Name}";
        args.ImageUrl = UriHelper.ToAbsoluteUri(relativePath).ToString();
    }
}
