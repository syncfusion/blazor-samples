@page "/tree-grid/selection-api"

@using Syncfusion.Blazor.TreeGrid
@using Syncfusion.Blazor.Grids
@using Syncfusion.Blazor.Inputs
@using Syncfusion.Blazor.Buttons

@*Hidden:Lines*@
@using TicketData
@inherits SampleBaseComponent;
@*End:Hidden*@

<ActionDescription>
<p>This sample illustrates programmatic row selection and clearing in the Tree Grid, enabling range selection by index and API-based deselection.</p>
    
    <p>This sample demonstrates multi-row selection in the Tree Grid. This is enabled by setting <code>Type</code> to <code>SelectionType.Multiple</code> and <code>Mode</code> to <code>SelectionMode.Row</code>.</p>
    
    <p>In this demo, you can programmatically select a range of rows by specifying the start and end indexes and clicking the <b>Select Row</b> button. The <b>Clear Selection</b> button removes all selections through the right panel.</p>
    
    <p>More information about selection in Tree Grid can be found in this <a target="_blank" rel="noopener" href="https://blazor.syncfusion.com/documentation/treegrid/selection/">documentation</a> section.</p>
</ActionDescription>




<div class="col-lg-9 control-section">
    <div class="content-wrapper">
        <div class="row">
            <SfTreeGrid @ref="TreeGridInstance" DataSource="@TreeGridData" IdMapping="TicketID" ParentIdMapping="ParentTicketID" TreeColumnIndex="1" Height="312" AllowSelection="true">
                <TreeGridSelectionSettings Type="Syncfusion.Blazor.Grids.SelectionType.Multiple" Mode="Syncfusion.Blazor.Grids.SelectionMode.Row"></TreeGridSelectionSettings>
                <TreeGridColumns>
                    <TreeGridColumn Field="TicketID" HeaderText="Ticket ID" Width="110" TextAlign="TextAlign.Right"></TreeGridColumn>
                    <TreeGridColumn Field="Title" ClipMode="ClipMode.EllipsisWithTooltip" HeaderText="Title" Width="220"></TreeGridColumn>
                    <TreeGridColumn Field="AssignedAgent" HeaderText="Assigned To" Width="140"></TreeGridColumn>
                    <TreeGridColumn Field="Category" HeaderText="Category" Width="110"></TreeGridColumn>
                    <TreeGridColumn Field="Status" HeaderText="Status" Width="110"></TreeGridColumn>
                    <TreeGridColumn Field="CreatedDate" HeaderText="Created Date" Format="d" Type="ColumnType.Date" ClipMode="ClipMode.EllipsisWithTooltip" TextAlign="TextAlign.Right" Width="130"></TreeGridColumn>
                    <TreeGridColumn Field="DueDate" HeaderText="Due Date" Format="d" Type="ColumnType.Date" TextAlign="TextAlign.Right" Width="110"></TreeGridColumn>
                </TreeGridColumns>
            </SfTreeGrid>

        </div>
    </div>
</div>

<PropertyPanel ControlSecClass="col-lg-9" CollapseChanged="RefreshTreeGrid">
    <h4 style="margin-top:38px;">Properties</h4>

    <table id="property" style="width: 73%; height: 300px;">
        <tr>
            <td class="left-side" style="padding-right:15px; display: inline-table;"><b>Select Rows</b></td>
        </tr>
        <tr>
            <td class="left-side" style="padding-right:15px;">Start</td>
            <td>
                <SfNumericTextBox @ref="StartRow" TValue="int?" Min="0" Max="12" Format="##0"></SfNumericTextBox>
            </td>
        </tr>
        <tr>
            <td class="left-side" style="padding-right:15px;">To</td>
            <td>
                <SfNumericTextBox @ref="EndRow" TValue="int?" Min="1" Max="12" Format="##0"></SfNumericTextBox>
            </td>
        </tr>
        <tr>
            <td class="left-side" style="padding-right:15px;"><b>Select Row</b></td>
            <td>
                <SfButton OnClick="Select" IsPrimary="true">Select Row</SfButton>
            </td>
        </tr>
        <tr>
            <td class="left-side" style="padding-right:15px;"><b>Clear Selection</b></td>
            <td>
                <SfButton OnClick="Clear" IsPrimary="true">Clear Selection</SfButton>
            </td>
        </tr>
    </table>

</PropertyPanel>

@code{
    
    private SfTreeGrid<SupportTicketData> TreeGridInstance { get; set; } = new SfTreeGrid<SupportTicketData>();

    private SfNumericTextBox<int?> StartRow { get; set; } = new SfNumericTextBox<int?>();

    private SfNumericTextBox<int?> EndRow { get; set; } = new SfNumericTextBox<int?>();

    private List<int> Rows { get; set; } = new List<int>();

    private List<SupportTicketData> TreeGridData { get; set; } = new List<SupportTicketData>();

    protected override void OnInitialized()
    {
        TreeGridData = SupportTicketData.GetSupportTickets().ToList();
    }

    public async void Select(MouseEventArgs args)
    {
        if (StartRow.Value.HasValue && EndRow.Value.HasValue)
        {
            int startRow = (StartRow.Value).Value;
            int endRow = (EndRow.Value).Value;
            if (endRow < startRow)
            {
                int Swap = endRow;
                endRow = startRow;
                startRow = Swap;
            }
            for (int i = startRow; i <= endRow; i++)
            {
                Rows.Add(i);
            }
            await TreeGridInstance.SelectRowsAsync(Rows.ToArray());
            Rows.Clear();
        }
    }

    public async void Clear(MouseEventArgs args)
    {
        await TreeGridInstance.ClearSelectionAsync();
        Rows.Clear();
    }

    async void RefreshTreeGrid()
    {
        await TreeGridInstance.RefreshAsync();
    }

}
