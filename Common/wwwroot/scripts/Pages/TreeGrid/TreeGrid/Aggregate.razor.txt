@page "/tree-grid/aggregate"

@using Syncfusion.Blazor.TreeGrid
@using Syncfusion.Blazor.Grids
@using Syncfusion.Blazor.Navigations
@*Hidden:Lines*@
@inherits SampleBaseComponent;
@using Summarydata
@*End:Hidden*@

<ActionDescription>
<p>
    This sample demonstrates aggregate functionality in the Tree Grid. Aggregates are displayed in the footer to summarize key metrics such as total, average, and count.
  </p>
  <p>
    Configure aggregates using <a target="_blank" rel="noopener" href="https://help.syncfusion.com/cr/blazor/Syncfusion.Blazor.TreeGrid.TreeGridAggregateColumn.html">TreeGridAggregateColumn</a> within the <a target="_blank" rel="noopener" href="https://help.syncfusion.com/cr/blazor/Syncfusion.Blazor.TreeGrid.TreeGridAggregates.html">TreeGridAggregates</a> collection.
  </p>
  <p>
    Supported aggregate types:
  </p>
  <ul>
    <li><code>Sum</code></li>
    <li><code>Average</code></li>
    <li><code>Min</code></li>
    <li><code>Max</code></li>
    <li><code>Count</code></li>
    <li><code>TrueCount</code></li>
    <li><code>FalseCount</code></li>
  </ul>
  <p>
    This demo uses <a target="_blank" rel="noopener" href="https://help.syncfusion.com/cr/blazor/Syncfusion.Blazor.TreeGrid.TreeGridAggregateColumn.html#Syncfusion_Blazor_TreeGrid_TreeGridAggregateColumn_FooterTemplate">FooterTemplate</a> to show: <strong>Total Sales</strong> and <strong>Total Profit</strong> (<code>Sum</code>), <strong>Average Unit Price</strong> (<code>Average</code>), and <strong>Item Count</strong> (<code>Count</code>). Aggregates appear at the bottom and include child summaries via <code>ShowChildSummary</code>.
  </p>
  <p>
    Learn more in the <a target="_blank" rel="noopener" href="https://blazor.syncfusion.com/documentation/treegrid/aggregate/">aggregates documentation</a>.
  </p>
</ActionDescription>

<div class="col-lg-12 control-section">
    <div class="content-wrapper">
        <div class="row">
            <SfTreeGrid TValue="SalesNode"
                        DataSource="@Data"
                        IdMapping="Id"
                        ParentIdMapping="ParentId"
                        TreeColumnIndex="1"
                        AllowSorting="true"
                        AllowFiltering="true"
                        AllowReordering="true"
                        Height="550px"
                        @ref="treeRef">

                <TreeGridFilterSettings Type="Syncfusion.Blazor.TreeGrid.FilterType.Menu" HierarchyMode="FilterHierarchyMode.Both"></TreeGridFilterSettings>
                <TreeGridEvents TValue="SalesNode" OnToolbarClick="OnToolbarClick">
                </TreeGridEvents>
                <TreeGridColumns>
                    <TreeGridColumn ShowInColumnChooser="false" Field="Id" HeaderText="ID" Width="90" TextAlign="TextAlign.Right" Visible="false"></TreeGridColumn>
                    <TreeGridColumn Field="Name" HeaderText="Name" Width="250"></TreeGridColumn>
                    <TreeGridColumn Field="Category" HeaderText="Category" Width="140"></TreeGridColumn>
                    <TreeGridColumn Field="Product" HeaderText="Product" Width="180"></TreeGridColumn>
                    <TreeGridColumn Field="Units" HeaderText="Units" Width="110" TextAlign="TextAlign.Right" Type="ColumnType.Integer"></TreeGridColumn>
                    <TreeGridColumn Field="UnitPrice" HeaderText="Unit Price" Width="180" TextAlign="TextAlign.Right" Format="C2" Type="ColumnType.Integer"></TreeGridColumn>
                    <TreeGridColumn Field="Sales" HeaderText="Sales" Width="180" TextAlign="TextAlign.Right" Format="C0" Type="ColumnType.Integer"></TreeGridColumn>
                    <TreeGridColumn Field="Profit" HeaderText="Profit" Width="180" TextAlign="TextAlign.Right" Format="C0" Type="ColumnType.Integer"></TreeGridColumn>
                    <TreeGridColumn Field="MarginPct" HeaderText="Margin" Width="160" TextAlign="TextAlign.Right" Format="P1" Type="ColumnType.Integer"></TreeGridColumn>
                </TreeGridColumns>
                <TreeGridAggregates>
                    <TreeGridAggregate ShowChildSummary="true">
                        <TreeGridAggregateColumns>
                            <TreeGridAggregateColumn Field="Sales" Type="@(AggregateType.Sum)" Format="C0">
                                <FooterTemplate>
                                    @($"Total Sales: {(context as Syncfusion.Blazor.Grids.AggregateTemplateContext).Sum}")
                                </FooterTemplate>
                            </TreeGridAggregateColumn>
                            <TreeGridAggregateColumn Field="Profit" Type="@(AggregateType.Sum)" Format="C0">
                                <FooterTemplate>
                                    @($"Total Profit: {(context as Syncfusion.Blazor.Grids.AggregateTemplateContext).Sum}")
                                </FooterTemplate>
                            </TreeGridAggregateColumn>
                            <TreeGridAggregateColumn Field="UnitPrice" Type="@(AggregateType.Average)" Format="C2">
                                <FooterTemplate>
                                    @($"Avg Unit Price: {(context as Syncfusion.Blazor.Grids.AggregateTemplateContext).Average}")
                                </FooterTemplate>
                            </TreeGridAggregateColumn>
                            <TreeGridAggregateColumn Field="Product" Type="@(AggregateType.Count)">
                                <FooterTemplate>
                                    @($"Items: {(context as Syncfusion.Blazor.Grids.AggregateTemplateContext).Count}")
                                </FooterTemplate>
                            </TreeGridAggregateColumn>
                        </TreeGridAggregateColumns>
                    </TreeGridAggregate>
                </TreeGridAggregates>
            </SfTreeGrid>
        </div>
    </div>
</div>

@code {

    private List<SalesNode> Data { get; set; } = new();

    protected override void OnInitialized()
    {
        // Use self-referential flat data with Id/ParentId mapping
        Data = RetailDataFactory.CreateFlat();
    }

    // Toolbar actions: trigger export
    private SfTreeGrid<SalesNode>? treeRef;
    private async Task OnToolbarClick(ClickEventArgs args)
    {
        if (treeRef is null) return;
        if (args.Item.Id?.Contains("excelexport", StringComparison.OrdinalIgnoreCase) == true)
        {
            await treeRef.ExportToExcelAsync();
        }
        else if (args.Item.Id?.Contains("pdfexport", StringComparison.OrdinalIgnoreCase) == true)
        {
            await treeRef.ExportToPdfAsync();
        }
    }
}
