@page "/pivot-table/toolbar"

@using Syncfusion.Blazor.PivotView
@using Syncfusion.Blazor
@*Hidden:Lines*@
@using ThemeHelper
@inherits SampleBaseComponent;
@*End:Hidden*@
@inject NavigationManager NavigationManager

<ActionDescription>
<p>
    This sample demonstrates the comprehensive toolbar options available in the pivot table, including report manipulations, formatting options, and export functionality for both pivot tables and pivot charts.
  </p>
  <p>
    Users can generate reports at runtime and manage them using save, load, rename, and delete operations. Save and load operations are performed in local variables using the <a target="_blank" rel="noopener" class="code" href="https://help.syncfusion.com/cr/blazor/Syncfusion.Blazor.PivotView.PivotViewEvents-1.html#Syncfusion_Blazor_PivotView_PivotViewEvents_1_SaveReport" aria-label="Class reference of SaveReport event in PivotView">SaveReport</a> and <a target="_blank" rel="noopener" class="code" href="https://help.syncfusion.com/cr/blazor/Syncfusion.Blazor.PivotView.PivotViewEvents-1.html#Syncfusion_Blazor_PivotView_PivotViewEvents_1_LoadReport" aria-label="Class reference of LoadReport event in PivotView">LoadReport</a> events. Users can dynamically switch between pivot table and pivot chart views using toolbar options.
  </p>
  <p>
    To enable the toolbar, set the <code>ShowToolbar</code> property in <a target="_blank" rel="noopener" class="code" href="https://help.syncfusion.com/cr/blazor/Syncfusion.Blazor.PivotView.SfPivotView-1.html" aria-label="Class reference of PivotView">SfPivotView</a> to <strong>true</strong>. The available toolbar options include:
  </p>
  <table>
    <tr>
      <td style="vertical-align: top;padding: 10px 0;width:230px"><strong>Create New Report</strong></td>
      <td>Allows users to create new reports at runtime.</td>
    </tr>
    <tr>
      <td style="vertical-align: top;padding: 4px 0;"><strong>Rename Report</strong></td>
      <td>Allows users to change the current report name dynamically through the UI.</td>
    </tr>
    <tr>
      <td style="vertical-align: top;padding: 4px 0;"><strong>Remove Report</strong></td>
      <td>Allows users to remove the current report from the report collection at runtime.</td>
    </tr>
    <tr>
      <td style="vertical-align: top;padding: 4px 0;"><strong>Save As Option</strong></td>
      <td>Allows users to save reports locally in browser memory.</td>
    </tr>
    <tr>
      <td style="vertical-align: top;padding: 4px 0;"><strong>Report List</strong></td>
      <td>Allows users to swap between reports within the report collection.</td>
    </tr>
    <tr>
      <td style="vertical-align: top;padding: 4px 0;"><strong>Pivot Table</strong></td>
      <td>Allows users to view data in cross-tabulation format.</td>
    </tr>
    <tr>
      <td style="vertical-align: top;padding: 4px 0;"><strong>Pivot Chart and Its Types</strong></td>
      <td>Allows users to view data in graphical format. Chart types include column, bar, line, area, and more. Options are available for showing/hiding legends and displaying chart series on single and multiple axes.</td>
    </tr>
    <tr>
      <td style="vertical-align: top;padding: 4px 0;"><strong>Export</strong></td>
      <td>Allows users to save data in PDF, Excel, and CSV document formats.</td>
    </tr>
    <tr>
      <td style="vertical-align: top;padding: 4px 0;"><strong>Hide Subtotals and Grand Totals</strong></td>
      <td>Allows users to hide grand totals and subtotals based on fields in rows and columns.</td>
    </tr>
    <tr>
      <td style="vertical-align: top;padding: 4px 0;"><strong>Conditional Formatting</strong></td>
      <td>Allows users to customize cells based on specific conditions.</td>
    </tr>
    <tr>
      <td style="vertical-align: top;padding: 4px 0;"><strong>Number Formatting</strong></td>
      <td>Allows users to dynamically apply number formatting to value fields.</td>
    </tr>
    <tr>
      <td style="vertical-align: top;padding: 4px 0;"><strong>Field List</strong></td>
      <td>Allows users to alter the report dynamically through the UI.</td>
    </tr>
  </table>
  <p>
    To define toolbar options, create a list with the necessary <a target="_blank" rel="noopener" class="code" href="https://help.syncfusion.com/cr/blazor/Syncfusion.Blazor.PivotView.ToolbarItems.html" aria-label="Class reference of ToolbarItems property in PivotView">ToolbarItems</a> enumeration values and add it to the <code>Toolbar</code> property in <a target="_blank" rel="noopener" class="code" href="https://help.syncfusion.com/cr/blazor/Syncfusion.Blazor.PivotView.SfPivotView-1.html" aria-label="Class reference of PivotView">SfPivotView</a>.
  </p>
  <p>
    For detailed information about the toolbar feature and customization options, refer to the <a target="_blank" rel="noopener" href="https://blazor.syncfusion.com/documentation/pivot-table/tool-bar/" aria-label="Blazor PivotTable Toolbar documentation">toolbar documentation</a>.
  </p>
</ActionDescription>


<div class="control-section">
    <div class="content-wrapper">
        <SfPivotView @ref="@Pivot" TValue="PivotProductDetails" Height="400" Width="100%" ShowFieldList=true ShowToolbar=true Toolbar="@PivotToolbar" AllowNumberFormatting=true AllowConditionalFormatting=true AllowCalculatedField=true AllowPdfExport=true AllowExcelExport=true EnableValueSorting=true ShowTooltip=false>
            <PivotViewDisplayOption Primary="Primary.Table" View="View.Both"></PivotViewDisplayOption>
            <PivotViewDataSourceSettings DataSource="@Data" ExpandAll=false EnableSorting=true ShowGrandTotals=true ShowSubTotals=true>
                <PivotViewColumns>
                    <PivotViewColumn Name="Year"></PivotViewColumn>
                    <PivotViewColumn Name="Order_Source" Caption="Order Source"></PivotViewColumn>
                </PivotViewColumns>
                <PivotViewRows>
                    <PivotViewRow Name="Country"></PivotViewRow>
                    <PivotViewRow Name="Products"></PivotViewRow>
                </PivotViewRows>
                <PivotViewValues>
                    <PivotViewValue Name="In_Stock" Caption="In Stock"></PivotViewValue>
                    <PivotViewValue Name="Sold" Caption="Units Sold"></PivotViewValue>
                    <PivotViewValue Name="Amount" Caption="Sold Amount"></PivotViewValue>
                </PivotViewValues>
                <PivotViewFilters>
                    <PivotViewFilter Name="Product_Categories" Caption="Product Categories"></PivotViewFilter>
                </PivotViewFilters>
                <PivotViewFormatSettings>
                    <PivotViewFormatSetting Name="Amount" Format="C0" UseGrouping=true></PivotViewFormatSetting>
                </PivotViewFormatSettings>
            </PivotViewDataSourceSettings>
            <PivotChartSettings Title="Sales Analysis" Theme="@Theme">
                <PivotChartPrimaryYAxis>
                    <PivotChartPrimaryYAxisBorder Width="0"></PivotChartPrimaryYAxisBorder>
                </PivotChartPrimaryYAxis>
            </PivotChartSettings>
            <PivotViewGridSettings ColumnWidth="120"></PivotViewGridSettings>
            <PivotViewEvents TValue="PivotProductDetails" RenameReport="RenameReport" RemoveReport="RemoveReport" SaveReport="SaveReport" LoadReport="LoadReport" FetchReport="FetchReport"></PivotViewEvents>
        </SfPivotView>
    </div>
</div>

<style>
    .e-pivotview {
        min-height: 200px;
    }

    html, body {
        height: 100%;
    }
</style>

@code{
    public SfPivotView<PivotProductDetails>? Pivot;
    public List<ToolbarItems> PivotToolbar = new List<ToolbarItems>
    {
        ToolbarItems.New,
        ToolbarItems.Save,
        ToolbarItems.SaveAs,
        ToolbarItems.Rename,
        ToolbarItems.Remove,
        ToolbarItems.Load,
        ToolbarItems.Grid,
        ToolbarItems.Chart,
        ToolbarItems.Export,
        ToolbarItems.SubTotal,
        ToolbarItems.GrandTotal,
        ToolbarItems.Formatting,
        ToolbarItems.FieldList
    };

    private Theme Theme { get; set; }
    public List<PivotProductDetails>? Data { get; set; }

    protected override void OnInitialized()
    {
        Theme = ThemeHelper.GetCurrentTheme(NavigationManager.Uri);
        this.Data = PivotProductDetails.GetProductData();
    }

    public string InitReport { get; set; } = string.Empty;
    public string[]? Name { get; set; }
    public List<string> Report = new List<string>();
    public List<string> ReportName = new List<string>();

    public void SaveReport(SaveReportArgs args)
    {
        int i = 0;
        bool IsSaved = false;
        for (i = 0; i < this.ReportName.Count; i++)
        {
            if (this.ReportName[i] == args.ReportName)
            {
                this.Report[i] = args.Report;
                IsSaved = true;
            }
        }

        if (args.Report != null && !(IsSaved))
        {
            this.Report.Add(args.Report);
            this.ReportName.Add(args.ReportName);
        }
    }

    public void FetchReport(FetchReportArgs args)
    {
        args.ReportName = ReportName.ToArray();
    }

    public async Task LoadReport(LoadReportArgs args)
    {
        int i = 0;
        int j = 0;
        for (i = 0; i < ReportName.Count; i++)
        {
            if (ReportName[i] == args.ReportName)
            {
                j = i;
            }
        }
        if(Pivot != null)
        {
            await this.Pivot.LoadPersistDataAsync(Report[j]);
        }
    }

    public async Task RemoveReport(RemoveReportArgs args)
    {
        int i = 0;
        for (i = 0; i < ReportName.Count; i++)
        {
            if (ReportName[i] == args.ReportName)
            {
                ReportName.RemoveAt(i);
                Report.RemoveAt(i);
                break;
            }
        }
    }

    public void RenameReport(RenameReportArgs args)
    {
        if (args.IsReportExists)
        {
            int j = 0;
            for (j = 0; j < ReportName.Count; j++)
            {
                if (ReportName[j] == args.Rename)
                {
                    ReportName.RemoveAt(j);
                    Report.RemoveAt(j);
                    break;
                }
            }
        }

        int i = 0;
        for (i = 0; i <= (ReportName.Count - 1); i++)
        {
            if (ReportName[i] == args.ReportName)
            {
                ReportName[i] = args.Rename;
            }
        }
    }
}