@page "/gantt-chart/load-on-demand"

@using Syncfusion.Blazor
@using Syncfusion.Blazor.Gantt
@using Syncfusion.Blazor.Data

@*Hidden:Lines*@
@inject SampleService SampleService
@implements IDisposable
@*End:Hidden*@

<SampleDescription>
  <p>
		This sample demonstrates the ability of the <a class="e-gantt-loadondemand-reference-link" aria-label="Navigate to the explore Syncfusion Blazor Gantt Chart component"
                                                       href="https://www.syncfusion.com/blazor-components/blazor-gantt-chart"
                                                       target="_blank">Blazor Gantt Chart</a> to visualize large data collections of up to 50,000 records while maintaining responsive interaction. Initial rendering limits the view to parent tasks so the timeline loads quickly even when the full hierarchy is extensive.
  </p>

  <p>
    Child tasks are retrieved when a parent row expands, demonstrating load on demand behavior backed by row virtualization and remote data binding. As scrolling progresses, only the records required for the current viewport are requested and rendered, conserving bandwidth and memory.
  </p>

 <p>
		When virtualization is enabled with remote data binding, the Gantt Chart downloads only root level records during the initial load. Configure the <a class="e-gantt-loadondemand-reference-link" aria-label="Navigate to the HasChildMapping property reference for Gantt task fields"
    href="https://help.syncfusion.com/cr/blazor/Syncfusion.Blazor.Gantt.GanttTaskFields.html#Syncfusion_Blazor_Gantt_GanttTaskFields_HasChildMapping"
																																						 target="_blank">HasChildMapping</a> property of <a class="e-gantt-loadondemand-reference-link" aria-label="Navigate to the class reference for Gantt task fields"
    href="https://help.syncfusion.com/cr/blazor/Syncfusion.Blazor.Gantt.GanttTaskFields.html"
    target="_blank">GanttTaskFields</a> to identify which items contain children so the component knows when to request additional data. Expanding a parent row triggers a new server call for its descendants, and vertical scrolling continues to fetch and render tasks dynamically based on the current viewport.
 </p>

  <p>
    For further details, refer to the
		<a class="e-gantt-loadondemand-reference-link" aria-label="Navigate to the documentation for load on demand in the Gantt chart component"
       href="https://blazor.syncfusion.com/documentation/gantt-chart/data-binding#load-child-on-demand"
       target="_blank">documentation</a>.
  </p>
</SampleDescription>

<div class="control-section e-gantt-load-on-demand-sample">
	<SfGantt @ref="GanttInstance" TValue="TaskData" Height="450px" Width="100%" LoadChildOnDemand="true" EnableRowVirtualization="true" EnableTimelineVirtualization="true"
			 ProjectStartDate="@(new DateTime(2000, 1, 1))" ProjectEndDate="@(new DateTime(2500, 12, 31))" ScrollToTaskbarOnClick="true">
		<SfDataManager Url="http://localhost:63028/api/GanttVirtualData" Adaptor="Adaptors.WebApiAdaptor"></SfDataManager>
		<GanttTaskFields Id="ID" Name="TaskName" StartDate="StartDate" EndDate="EndDate"
						 Duration="Duration" Dependency="Predecessor" ParentID="ParentId" HasChildMapping="IsParent">
		</GanttTaskFields>
	</SfGantt>
</div>

@code {
	public SfGantt<TaskData>? GanttInstance { get; set; }
	public class TaskData
	{
		public int ID { get; set; }
		public string TaskName { get; set; } = string.Empty;
		public DateTime StartDate { get; set; }
		public DateTime EndDate { get; set; }
		public string? Duration { get; set; }
		public int? ParentId { get; set; }
		public string Predecessor { get; set; } = string.Empty;
		public bool? IsParent { get; set; }
	}
	@*Hidden:Lines*@
	protected override void OnInitialized()
	{
		SampleService.TouchMousePreferenceChanged += OnTouchMousePreferenceChanged;
	}
	
	private async void OnTouchMousePreferenceChanged()
	{
		await GanttInstance.RefreshAsync();
		await GanttInstance.CallStateHasChangedAsync();
	}

	public void Dispose()
	{
		SampleService.TouchMousePreferenceChanged -= OnTouchMousePreferenceChanged;
	}
	@*End:Hidden*@
}

<style>
	.container-fluid {
		padding: 0px !important;
	}

	.e-gantt-load-on-demand-sample {
		padding: 20px;
	}

	.e-gantt-loadondemand-reference-link {
		text-decoration: none !important;
	}

	.e-gantt-loadondemand-reference-link:hover,
	.e-gantt-loadondemand-reference-link:focus {
		text-decoration: underline !important;
	}
</style>