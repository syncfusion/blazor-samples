@page "/gantt-chart/column-validation"

@using Syncfusion.Blazor.Gantt
@using Syncfusion.Blazor.Grids
@using Syncfusion.Blazor.DropDowns
@using BlazorDemos.Pages.GanttChart.Data

@*Hidden:Lines*@
@inject SampleService SampleService
@implements IDisposable
@*End:Hidden*@

<SampleDescription>
    <p>
        This sample demonstrates column level validation in the <a class="e-gantt-columnvalidation-reference-link" aria-label="Navigate to the explore Syncfusion Blazor Gantt Chart component" href="https://www.syncfusion.com/blazor-components/blazor-gantt-chart" target="_blank">Blazor Gantt Chart</a> for a Website Redesign Project. Validation ensures that tasks cannot be saved with missing details, incorrect formats, or out-of-range values, helping maintain accurate timelines and reliable project delivery.
    </p>
    <p>
        Invalid inputs trigger tooltips with correction details, and records cannot be saved until all validations succeed. In this sample validation is configured per column using the <a class="e-gantt-columnvalidation-reference-link" href="https://help.syncfusion.com/cr/blazor/Syncfusion.Blazor.Gantt.GanttEditSettings.html" target="_blank">Validator</a> component and enforced during <strong>Add</strong> and <strong>Edit</strong> operations, includes:
        <ul>
            <li><strong>Date rules:</strong> Start and end dates must fall within the project start date (project launch) and end date (go-live) range.</li>
            <li><strong>Completed task validation:</strong> Once a task status is marked as completed, start date, end date, and duration cannot be changed.</li>
            <li><strong>Priority based constraints:</strong> Specific scheduling constraints and limits apply for low, high, and critical priorities, including maximum duration and team size rules.</li>
            <li><strong>Progress tracking and dependency validation:</strong> Enforce valid progress ranges and ensure predecessors are completed before dependent tasks can progress.</li>
            <li><strong>Field validity and formats:</strong> Required fields and regex checks ensure task name length, description (10–500 characters), project codes (PRJ-XXX-000), valid email/us phone formats, and hashtags are correct.</li>
            <li><strong>Budget checks:</strong> Validate budget minimum and maximum limits, and block extensions when a task exceeds its budget.</li>
        </ul>
    </p>
    <p>
        The Gantt Chart enforces <a class="e-gantt-columnvalidation-reference-link" href="https://help.syncfusion.com/cr/blazor/Syncfusion.Blazor.Gantt.GanttColumn.html" target="_blank">ValidationRules</a> as well using required, number, range, min/max, minlength/maxlength, pattern (regex), and email rules. These validations apply to fields such as task names, dates, duration, progress, team size, budgeting, and contact details to keep project data accurate and consistent.
        For details on validation rules, data annotations, custom validation, and custom validator components, refer to the
        <a aria-label="Navigate to the documentation for column validation in Gantt Chart" target="_blank" class="e-gantt-columnvalidation-reference-link" href="https://blazor.syncfusion.com/documentation/gantt-chart/overview">documentation</a>.
    </p>
</SampleDescription>
<div class="control-section e-gantt-column-validation-sample">
    <SfGantt @ref="GanttInstance" DataSource="@ProjectTasks" Height="500px" Width="100%" HighlightWeekends="true" TreeColumnIndex="1" ProjectStartDate="new DateTime(2025, 1, 5)" ProjectEndDate="new DateTime(2025, 3, 29)" TValue="ProjectManagementModel.TaskModel"
             ScrollToTaskbarOnClick="true" Toolbar="@(new List<string>() { "Add", "Edit", "Update", "Cancel" })">
        <GanttTaskFields Id="Id" Name="TaskName" StartDate="StartDate" EndDate="EndDate" Duration="Duration"
                         Progress="Progress" Dependency="Predecessor" ParentID="ParentId" Notes="Description">
        </GanttTaskFields>
        <GanttEditSettings AllowAdding="true" AllowEditing="true">
            <Validator>
                @{
                    ValidatorTemplateContext? txt = context as ValidatorTemplateContext;
                }
                <ColumnValidator Context="@txt"></ColumnValidator>
            </Validator>
        </GanttEditSettings>
        <GanttColumns>
            <GanttColumn Field="Id" HeaderText="ID" Width="60"/>
            <GanttColumn Field="TaskName" HeaderText="Task Name" Width="250" ClipMode="Syncfusion.Blazor.Grids.ClipMode.EllipsisWithTooltip" />
            <GanttColumn Field="StartDate" HeaderText="Start Date" Width="130" EditType="EditType.DateTimePickerEdit" />
            <GanttColumn Field="EndDate" HeaderText="End Date" Width="130" EditType="EditType.DateTimePickerEdit" />
            <GanttColumn Field="Duration" HeaderText="Duration" Width="140" />
            <GanttColumn Field="Progress" HeaderText="Progress (%)" Width="140" EditType="EditType.NumericEdit" />
            <GanttColumn Field="Predecessor" HeaderText="Dependency" Width="140" />
            <GanttColumn Field="OwnerEmail" HeaderText="Owner Email" Width="220" EditType="EditType.DefaultEdit" />
            <GanttColumn Field="TaskCode" HeaderText="Task Code" Width="160" EditType="EditType.DefaultEdit" />
            <GanttColumn Field="TeamSize" HeaderText="Team Size" Width="120" EditType="EditType.NumericEdit" />
            <GanttColumn Field="Tags" HeaderText="Tags" Width="240" EditType="EditType.DefaultEdit" />
            <GanttColumn Field="ContactPhone" HeaderText="Contact Phone" Width="180" EditType="EditType.DefaultEdit" />
            <GanttColumn Field="Budget" HeaderText="Budget" Format="C" Width="140" EditType="EditType.NumericEdit" />
            <GanttColumn Field="ActualCost" HeaderText="Actual Cost" Format="C" Width="140" EditType="EditType.NumericEdit" />
            <GanttColumn Field="Status" HeaderText="Status" Width="140">
                <EditTemplate>
                    @if (context is ProjectManagementModel.TaskModel row)
                    {
                        <SfDropDownList TValue="string" TItem="string"
                                        DataSource="StatusOptions"
                                        ID="@nameof(ProjectManagementModel.TaskModel.Status)"
                                        @bind-Value="row.Status"
                                        AllowFiltering="false"
                                        Placeholder="Select status"
                                        FloatLabelType="Syncfusion.Blazor.Inputs.FloatLabelType.Auto"
                                        PopupHeight="250px">
                        </SfDropDownList>
                    }
                </EditTemplate>
            </GanttColumn>
            <GanttColumn Field="Priority" HeaderText="Priority" Width="120">
                <EditTemplate>
                    @if (context is ProjectManagementModel.TaskModel row)
                    {
                        <SfDropDownList TValue="string" TItem="string"
                                        DataSource="PriorityOptions"
                                        ID="@nameof(ProjectManagementModel.TaskModel.Priority)"
                                        @bind-Value="row.Priority"
                                        AllowFiltering="false"
                                        FloatLabelType="Syncfusion.Blazor.Inputs.FloatLabelType.Auto"
                                        Placeholder="Select priority">
                        </SfDropDownList>
                    }
                </EditTemplate>
            </GanttColumn>
            <GanttColumn Field="Description" HeaderText="Description" Width="260" TextAlign="TextAlign.Center" />
        </GanttColumns>
        <GanttEventMarkers>
            <GanttEventMarker Day="new DateTime(2025, 1, 6)" Label="Project Launch" CssClass="e-custom-event-marker"></GanttEventMarker>
            <GanttEventMarker Day="new DateTime(2025, 1, 27)" Label="Development Start" CssClass="e-custom-event-marker"></GanttEventMarker>
            <GanttEventMarker Day="new DateTime(2025, 3, 21)" Label="Go-Live" CssClass="e-custom-event-marker"></GanttEventMarker>
        </GanttEventMarkers>
        <GanttAddDialogFields>
            <GanttAddDialogField Type="GanttDialogFieldType.General" HeaderText="General"></GanttAddDialogField>
            <GanttAddDialogField Type="GanttDialogFieldType.Custom" HeaderText="Custom Fields"></GanttAddDialogField>
            <GanttAddDialogField Type="GanttDialogFieldType.Dependency" HeaderText="Dependencies"></GanttAddDialogField>
            <GanttAddDialogField Type="GanttDialogFieldType.Notes" HeaderText="Description"></GanttAddDialogField>
        </GanttAddDialogFields>

        <GanttEditDialogFields>
            <GanttEditDialogField Type="GanttDialogFieldType.General" HeaderText="General"></GanttEditDialogField>
            <GanttEditDialogField Type="GanttDialogFieldType.Custom" HeaderText="Custom Fields"></GanttEditDialogField>
            <GanttEditDialogField Type="GanttDialogFieldType.Dependency" HeaderText="Dependencies"></GanttEditDialogField>
            <GanttEditDialogField Type="GanttDialogFieldType.Notes" HeaderText="Description"></GanttEditDialogField>
        </GanttEditDialogFields>
        <GanttHolidays>
            <GanttHoliday From="new DateTime(2025, 1, 20)" To="new DateTime(2025, 1, 20)" Label="Martin Luther King Jr. Day"></GanttHoliday>
            <GanttHoliday From="new DateTime(2025, 2, 17)" To="new DateTime(2025, 2, 17)" Label="Presidents’ Day"></GanttHoliday>
        </GanttHolidays>
        <GanttSplitterSettings ColumnIndex="2"></GanttSplitterSettings>
        <GanttEvents OnCellEdit="GanttBeforeCellEditHandler" GanttDialogOpening="GanttDialogOpeningHandlerAsync" TValue="ProjectManagementModel.TaskModel"></GanttEvents>
        <GanttLabelSettings RightLabel="TaskName" TValue="ProjectManagementModel.TaskModel"></GanttLabelSettings>
    </SfGantt>
</div>
@code{

    /// <summary>
    /// Initializes the ColumnValidation sample with Gantt task data.
    /// </summary>
    protected override void OnInitialized()
    {
        ProjectTasks = ProjectManagementModel.GetProjectManagementData();
        @*Hidden:Lines*@
        SampleService.TouchMousePreferenceChanged += OnTouchMousePreferenceChanged;
        @*End:Hidden*@
    }
    @*Hidden:Lines*@
    private async void OnTouchMousePreferenceChanged()
    {
        await GanttInstance.RefreshAsync();
        await GanttInstance.CallStateHasChangedAsync();
    }

    public void Dispose()
    {
        SampleService.TouchMousePreferenceChanged -= OnTouchMousePreferenceChanged;
    }
    @*End:Hidden*@
}

<style>
    .container-fluid {
        padding: 0px !important;
    }
    .e-bigger .e-gantt .e-gantt-chart .e-event-markers .e-span-label {
        top: 255px !important;
    }
    .e-bigger .e-gantt .e-gantt-chart .e-event-markers .e-gantt-right-arrow {
        top: 263px !important;
    }
</style>