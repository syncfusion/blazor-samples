@page "/file-manager/template"

@using System.IO;
@using Syncfusion.Blazor.FileManager;
@using Syncfusion.Blazor.Navigations;
@using Syncfusion.Blazor.SplitButtons;
@inject NavigationManager UriHelper;
@*Hidden:Lines*@
@inherits SampleBaseComponent
@*End:Hidden*@

<ActionDescription>
<p>This sample showcases comprehensive customization capabilities of the <a target="_blank" rel="noopener" href="https://www.syncfusion.com/blazor-components/blazor-file-manager" aria-label="Feature Tour of Blazor File Manager">Blazor File Manager</a> using template support across multiple views.</p>
    
    <p>Template customization areas:</p>
    
    <ul>
        <li><code>NavigationPaneTemplate</code> - Renders folder nodes with custom icons based on folder names</li>
        <li><code>LargeIconsTemplate</code> - Displays files with styled backgrounds and action menus</li>
        <li><code>FileManagerDetailsViewSettings</code> template - Presents file information in columns (name, size, modified date)</li>
    </ul>
    
    <p>File operations are handled through dropdown menu options in each item, triggering corresponding FileManager methods:</p>
    
    <ul>
        <li><code>OpenFileAsync</code> - Open file operation</li>
        <li><code>DownloadFilesAsync</code> - Download file operation</li>
        <li><code>DeleteFilesAsync</code> - Delete file operation</li>
        <li><code>RefreshFilesAsync</code> - Refresh operation</li>
    </ul>
</ActionDescription>


<div class="control-section">
    <SfFileManager CssClass="e-fm-template-sample" @ref="FileManager" Height="600px" TValue="FileManagerDirectoryContent" ID="fileManager">
        <ChildContent>
            <FileManagerAjaxSettings Url="https://ej2-aspcore-service.azurewebsites.net/api/FileManager/FileOperations"
                                     UploadUrl="https://ej2-aspcore-service.azurewebsites.net/api/FileManager/Upload"
                                     DownloadUrl="https://ej2-aspcore-service.azurewebsites.net/api/FileManager/Download"
                                     GetImageUrl="https://ej2-aspcore-service.azurewebsites.net/api/FileManager/GetImage">
            </FileManagerAjaxSettings>
            <FileManagerEvents TValue="FileManagerDirectoryContent" MenuOpened="MenuOpened" />
            <FileManagerDetailsViewSettings>
                <FileManagerColumns>
                    <FileManagerColumn Field="Name" HeaderText="Name">
                        <Template Context="context">
                            @if (context is FileManagerDirectoryContent item)
                            {
                                <div class="details-name-template-vertical" title="@item.Name">
                                    <div>@item.Name</div>
                                </div>
                            }
                        </Template>
                    </FileManagerColumn>
                    <FileManagerColumn Field="Size" HeaderText="Size">
                        <Template Context="context">
                            @if (context is FileManagerDirectoryContent item)
                            {
                                <div>@(item.IsFile ? FormatSize(item.Size) : "-")</div>
                            }
                        </Template>
                    </FileManagerColumn>
                    <FileManagerColumn Field="DateModified" HeaderText="Date Modified" />
                    <FileManagerColumn HeaderText="Actions">
                        <Template Context="context">
                            @if (context is FileManagerDirectoryContent item)
                            {
                                <SfDropDownButton CssClass="e-caret-hide filemanager-dropdown-button" IconCss="e-icons e-more-vertical-1">
                                    <DropDownButtonEvents ItemSelected="args => OnDropDownItemSelected(args, item)" />
                                    <DropDownMenuItems>
                                        @foreach (var (text, iconCss) in MenuItems)
                                        {
                                            <DropDownMenuItem Text="@text" IconCss="@iconCss" />
                                        }
                                        @if (!item.IsFile)
                                        {
                                            <DropDownMenuItem Text="Open" IconCss="e-icons e-folder-open" />
                                        }
                                    </DropDownMenuItems>
                                </SfDropDownButton>
                            }
                        </Template>
                    </FileManagerColumn>
                </FileManagerColumns>
            </FileManagerDetailsViewSettings>
        </ChildContent>

        <LargeIconsTemplate Context="item">
            @if (item is not null)
            {
                <div class="custom-icon-card">
                    <div class="file-header">
                        <div class="left-info">
                            @if (item.IsFile)
                            {
                                <div class="@GetFileTypeCssClass(item)"></div>
                            }
                            <div class="file-name" title="@item.Name">@item.Name</div>
                        </div>
                        <SfDropDownButton CssClass="e-caret-hide filemanager-dropdown-button" IconCss="e-icons e-more-vertical-1">
                            <DropDownButtonEvents ItemSelected="args => OnDropDownItemSelected(args, item)" />
                            <DropDownMenuItems>
                                @foreach (var (text, iconCss) in MenuItems)
                                {
                                    <DropDownMenuItem Text="@text" IconCss="@iconCss" />
                                }
                                @if (!item.IsFile)
                                {
                                    <DropDownMenuItem Text="Open" IconCss="e-icons e-folder-open" />
                                }
                            </DropDownMenuItems>
                        </SfDropDownButton>
                    </div>
                    <div class="@GetBackgroundCss(item)" title="@item.Name"></div>
                    <div class="file-formattedDate">Created on @item.DateCreated.ToString("MMMM d, yyyy")</div>
                </div>
            }
        </LargeIconsTemplate>

        <NavigationPaneTemplate>
            <div class="e-nav-pane-node" style="display: inline-flex; align-items: center;">
                @if (context is FileManagerDirectoryContent item)
                {
                    <span class="e-icons @GetIconsForFolders(item)"></span>
                    <span class="folder-name" style="margin-left:8px;">@item.Name</span>
                }
            </div>
        </NavigationPaneTemplate>
    </SfFileManager>
</div>

@code {
    SfFileManager<FileManagerDirectoryContent> FileManager;

    private static readonly (string Text, string IconCss)[] MenuItems =
    {
        ("Delete", "e-icons e-trash"),
        ("Download", "e-icons e-download"),
        ("Refresh", "e-icons e-refresh")
    };

    private static readonly string[] SizeSuffixes = { "B", "KB", "MB", "GB", "TB" };

    private static readonly Dictionary<string, string> FolderIcons = new Dictionary<string, string>(StringComparer.OrdinalIgnoreCase)
    {
        { "Files", "e-folder" }, { "Documents", "e-file-document" }, { "Downloads", "e-download" },
        { "Pictures", "e-thumbnail" }, { "Music", "e-file-format" }, { "Videos", "e-video" },
        { "Employees", "e-export-png" }, { "Food", "e-export-png" }, { "Nature", "e-export-png" }
    };

    private static readonly Dictionary<string, string> ExtensionIconClassMap = new Dictionary<string, string>(StringComparer.OrdinalIgnoreCase)
    {
        { "jpg", "image" }, { "jpeg", "image" }, { "png", "image" }, { "gif", "image" },
        { "mp3", "music" }, { "wav", "music" }, { "mp4", "video" }, { "avi", "video" },
        { "xlsx", "xlsx" }, { "xls", "xlsx" }, { "pptx", "pptx" }, { "ppt", "pptx" },
        { "rar", "rar" }, { "zip", "zip" }, { "txt", "txt" }, { "js", "js" },
        { "css", "css" }, { "html", "html" }, { "exe", "exe" }, { "msi", "msi" },
        { "php", "php" }, { "doc", "doc" }, { "docx", "docx" }, { "xml", "xml" },
        { "pdf", "pdf" }
    };

    private static readonly Dictionary<string, string> NamedFileBackgrounds = new Dictionary<string, string>(StringComparer.OrdinalIgnoreCase)
    {
        { "Adam.png", "background-Adam" }, { "Andrew.png", "background-Andrew" }, { "Ellie.png", "background-Ellie" },
        { "Jameson.png", "background-Jameson" }, { "John.png", "background-John" }, { "Josie.png", "background-Josie" },
        { "Apple pie.png", "background-Applepie" }, { "Bread.png", "background-Bread" }, { "Doughnut.png", "background-Doughnut" },
        { "Nuggets.png", "background-Nuggets" }, { "Sugar cookie.png", "background-Sugarcookie" },
        { "bird.jpg", "background-bird" }, { "sea.jpg", "background-sea" }, { "seaview.jpg", "background-seaview" },
        { "snow.jpg", "background-snow" }, { "snowfall.jpg", "background-snowfall" }
    };

    private static readonly Dictionary<string, string> ExtensionBackgrounds = new Dictionary<string, string>(StringComparer.OrdinalIgnoreCase)
    {
        { "jpg", "background-jpg" }, { "jpeg", "background-jpg" }, { "png", "background-png" },
        { "pptx", "background-pptx" }, { "pdf", "background-pdf" }, { "mp4", "background-video" },
        { "mp3", "background-audio" }, { "docx", "background-doc" }, { "txt", "background-txt" },
        { "xlsx", "background-xlsx" }
    };

    private Task OnDropDownItemSelected(MenuEventArgs args, FileManagerDirectoryContent item)
    {
        switch (args.Item.Text)
        {
            case "Open":
                return FileManager.OpenFileAsync(item.Name);
            case "Delete":
                return FileManager.DeleteFilesAsync(new[] { item.Name });
            case "Download":
                return FileManager.DownloadFilesAsync(new[] { item.Name });
            case "Refresh":
                return FileManager.RefreshFilesAsync();
            default:
                return Task.CompletedTask;
        }
    }

    private void MenuOpened(MenuOpenEventArgs<FileManagerDirectoryContent> args)
    {
        args.Cancel = true;
    }

    private string FormatSize(long bytes)
    {
        double len = bytes;
        var index = 0;

        while (len >= 1024 && index < SizeSuffixes.Length - 1)
        {
            len /= 1024;
            index++;
        }

        return $"{len:0.##} {SizeSuffixes[index]}";
    }

    private string GetFileTypeCssClass(FileManagerDirectoryContent item)
    {
        if (!item.IsFile)
        {
            return string.Empty;
        }

        var ext = Path.GetExtension(item.Name)?.TrimStart('.') ?? string.Empty;
        var type = ExtensionIconClassMap.GetValueOrDefault(ext, "unknown");
        return $"e-list-icon e-fe-{type}";
    }

    private static string GetIconsForFolders(FileManagerDirectoryContent item)
    {
        return FolderIcons.GetValueOrDefault(item.Name, "e-folder");
    }

    private string GetBackgroundCss(FileManagerDirectoryContent item)
    {
        if (!item.IsFile)
        {
            return "file-icon background-folder";
        }

        if (NamedFileBackgrounds.TryGetValue(item.Name, out var namedBackground))
        {
            return $"file-icon {namedBackground}";
        }

        var ext = Path.GetExtension(item.Name)?.TrimStart('.') ?? string.Empty;
        var background = ExtensionBackgrounds.GetValueOrDefault(ext, "background-default");
        return $"file-icon {background}";
    }

    private string Asset(string file)
    {
        return UriHelper.ToAbsoluteUri($"{SampleService?.WebAssetsPath}images/filemanager/icons/{file}").ToString();
    }
}

<style>
    .e-filemanager.e-fm-template-sample .e-list-icon {
        height: 20px !important;
        margin: 0 !important;
        width: 20px !important;
    }

    .e-dropdown-btn.filemanager-dropdown-button {
        border: none;
        margin-right: -6px;
        box-shadow: none;
        background: transparent;
    }

    .e-dropdown-btn.filemanager-dropdown-button:hover, .e-dropdown-btn.filemanager-dropdown-button.e-btn:hover {
        background: #d4d4d4;
    }

    .fluent2-dark .e-dropdown-btn.filemanager-dropdown-button:hover, .fluent2-dark .e-dropdown-btn.filemanager-dropdown-button.e-btn:hover,
    .fluent-dark .e-dropdown-btn.filemanager-dropdown-button:hover, .fluent-dark .e-dropdown-btn.filemanager-dropdown-button.e-btn:hover,
    .material3-dark .e-dropdown-btn.filemanager-dropdown-button:hover, .material3-dark .e-dropdown-btn.filemanager-dropdown-button.e-btn:hover,
    .tailwind3-dark .e-dropdown-btn.filemanager-dropdown-button:hover, .tailwind3-dark .e-dropdown-btn.filemanager-dropdown-button.e-btn:hover,
    .fluent2-highcontrast .e-dropdown-btn.filemanager-dropdown-button:hover, .fluent2-highcontrast .e-dropdown-btn.filemanager-dropdown-button.e-btn:hover,
    .highcontrast .e-dropdown-btn.filemanager-dropdown-button:hover, .highcontrast .e-dropdown-btn.filemanager-dropdown-button.e-btn:hover,
    .bootstrap5\.3-dark .e-dropdown-btn.filemanager-dropdown-button:hover, .bootstrap5\.3-dark .e-dropdown-btn.filemanager-dropdown-button.e-btn:hover {
        background: #3d3d3d;
    }

    .bootstrap5\.3 .e-dropdown-btn.filemanager-dropdown-button {
        color: #242424;
    }

    .e-dropdown-btn.filemanager-dropdown-button .e-btn-icon, .e-dropdown-btn.e-btn.filemanager-dropdown-button .e-btn-icon {
        margin-right: -20px;
        margin-left: -20px;
    }

    .e-filemanager.e-fm-template-sample .e-grid .e-gridheader .e-fe-grid-icon + .e-rowcell, .e-filemanager .e-grid .e-gridheader .e-fe-grid-icon + .e-headercell, .e-filemanager .e-grid .e-gridcontent .e-fe-grid-icon + .e-rowcell, .e-filemanager .e-grid .e-gridcontent .e-fe-grid-icon + .e-headercell {
        padding-left: 6px;
    }

    .e-fm-template-sample .details-name-template-vertical .details-line {
        font-size: 13px;
        line-height: 1.4;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    .e-fm-template-sample .e-nav-pane-node .e-icons {
        font-size: larger;
    }

    .e-fm-template-sample .custom-icon-card {
        padding: 8px;
        border: 1px solid #ccc;
        border-radius: 10px;
        height: 100%;
        box-sizing: border-box;
        display: flex;
        flex-direction: column;
        justify-content: flex-start;
        align-items: center;
    }

    .e-fm-template-sample .file-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        width: 100%;
        margin-bottom: 10px;
    }

    .e-fm-template-sample .left-info {
        display: flex;
        align-items: center;
        gap: 8px;
        overflow: hidden;
        flex-shrink: 1;
        flex-grow: 1;
    }

    .e-fm-template-sample .file-name {
        font-size: 14px;
        font-weight: 600;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        max-width: 160px;
    }

    .e-fm-template-sample .file-formattedDate {
        font-size: 12px;
        margin-top: 8px;
        text-align: center;
        font-weight: 600;
    }

    .e-filemanager.e-fm-template-sample.e-fe-mobile .e-large-icons .e-list-parent .e-list-item {
        height: 185px;
        width: 100px;
        margin: 8px 4px;
    }

    .e-filemanager.e-fm-template-sample.e-fe-mobile .e-large-icons .e-list-parent .e-list-item .file-icon {
        width: 150px;
        height: 90px;
    }

    .e-filemanager.e-fm-template-sample.e-fe-mobile .e-large-icons .e-list-parent .e-list-item .file-name {
        max-width: 100px;
    }

    .e-filemanager.e-fm-template-sample .e-large-icons .e-list-item {
        height: 240px;
        width: 210px;
    }

    .e-filemanager.e-fm-template-sample .e-large-icons .e-list-parent .e-list-item .file-icon {
        width: 190px;
        height: 150px;
        background-repeat: no-repeat;
        background-position: center center;
        background-size: contain;
        margin-bottom: 10px;
    }

    .background-folder { background-image: url('@Asset("folders.svg")'); }
    .background-png { background-image: url('@Asset("image-png.svg")'); }
    .background-pptx { background-image: url('@Asset("pptx.png")'); }
    .background-jpg { background-image: url('@Asset("image-jpg.svg")'); }
    .background-doc { background-image: url('@Asset("docx.png")'); }
    .background-pdf { background-image: url('@Asset("pdfphoto.png")'); }
    .background-txt { background-image: url('@Asset("text.png")'); }
    .background-video { background-image: url('@Asset("video.png")'); }
    .background-audio { background-image: url('@Asset("music.png")'); }
    .background-xlsx { background-image: url('@Asset("xlsx.png")'); }

    .background-Adam { background-image: url('@Asset("adam.png")'); }
    .background-Andrew { background-image: url('@Asset("andrew.png")'); }
    .background-Ellie { background-image: url('@Asset("ellie.png")'); }
    .background-Jameson { background-image: url('@Asset("jameson.png")'); }
    .background-John { background-image: url('@Asset("john.png")'); }
    .background-Josie { background-image: url('@Asset("josie.png")'); }

    .background-Applepie { background-image: url('@Asset("apple-pie.png")'); }
    .background-Bread { background-image: url('@Asset("bread.png")'); }
    .background-Doughnut { background-image: url('@Asset("doughnut.png")'); }
    .background-Nuggets { background-image: url('@Asset("nuggets.png")'); }
    .background-Sugarcookie { background-image: url('@Asset("sugar-cookie.png")'); }

    .background-bird { background-image: url('@Asset("bird.png")'); }
    .background-sea { background-image: url('@Asset("sea.png")'); }
    .background-seaview { background-image: url('@Asset("seaview.png")'); }
    .background-snow { background-image: url('@Asset("snow.png")'); }
    .background-snowfall { background-image: url('@Asset("snowfall.png")'); }
</style>