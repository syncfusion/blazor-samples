@page "/tree-grid/remote-data"

@using Syncfusion.Blazor.TreeGrid
@using Syncfusion.Blazor.Grids
@using Syncfusion.Blazor.Data
@using Syncfusion.Blazor
@using Syncfusion.Blazor.Buttons
@*Hidden:Lines*@
@inherits SampleBaseComponent;
@*End:Hidden*@
<SampleDescription>
    <p>This sample demonstrates binding remote data to the Tree Grid, enabling server-driven queries and on-demand loading of child records for scalable hierarchical rendering.</p>
</SampleDescription>

<ActionDescription>
    <p>Remote binding is configured by adding <a aria-label="Navigate to the documentation for getting started with data manager component" target="_blank" href="https://help.syncfusion.com/cr/blazor/Syncfusion.Blazor.DataManager.html">SfDataManager</a> to the Tree Grid, setting the endpoint through the <code>Url</code> property, and defining the transport via an <a aria-label="Navigate to the Adaptor property reference for the data manager component" target="_blank" href="https://help.syncfusion.com/cr/blazor/Syncfusion.Blazor.DataManager.html#Syncfusion_Blazor_DataManager_Adaptor">Adaptor</a>.</p>
    <p>In this demo, parent rows are initially loaded in a collapsed state, and child records can be retrieved along with parent records by toggling the Tree Grid's <code>LoadChildOnDemand</code> property. This sample uses <b>WebApiAdaptor</b> to communicate with a Web API endpoint.</p>
    <p>The SfDataManager, which acts as an interface between the service endpoint and the Tree Grid, requires the following minimal configuration:</p>
    <ul>
        <li><code>SfDataManager.Url</code>: Defines the service endpoint to fetch data.</li>
        <li><code>SfDataManager.Adaptor</code>: Defines the adaptor option (example: <b>WebApiAdaptor</b>).</li>
    </ul>
    <p>The adaptor processes requests and responses between the Tree Grid and the service endpoint. The <a aria-label="Navigate to namespace reference for the data manager component" target="_blank" href="https://help.syncfusion.com/cr/blazor/Syncfusion.Blazor.Data.html">Syncfusion.Blazor.Data</a> namespace provides predefined adaptors for specific endpoints:</p>
    <ul>
        <li><b>UrlAdaptor</b>: Base adaptor for interacting with any remote service.</li>
        <li><b>ODataAdaptor</b>: For OData endpoints.</li>
        <li><b>ODataV4Adaptor</b>: For OData V4 endpoints.</li>
        <li><b>WebApiAdaptor</b>: For Web API endpoints built under OData standards.</li>
    </ul>
    <p>More information on data binding can be found in the <a target="_blank" href="https://blazor.syncfusion.com/documentation/treegrid/data-binding#remote-service-binding">documentation</a> section.</p>
</ActionDescription>

<div class="row">
    <div class="col-lg-9 control-section">
        <div class="content-wrapper">
            <SfTreeGrid @ref="treeGrid" TValue="ContentItem" IdMapping="ID" ParentIdMapping="ParentItem" HasChildMapping="isParent" TreeColumnIndex="1" Height="380" AllowPaging="true" AllowSorting="true" LoadChildOnDemand="@loadChildOnDemand" Query="@GridQuery">
                <SfDataManager Url="https://blazor.syncfusion.com/services/development/api/PortalContent" Adaptor="Adaptors.WebApiAdaptor" CrossDomain="true"></SfDataManager>
                <TreeGridPageSettings PageSize="@GridPageSize"></TreeGridPageSettings>
                <TreeGridColumns>
                    <TreeGridColumn Field="ID" HeaderText="ID" Width="80" TextAlign="TextAlign.Right" Visible="false"></TreeGridColumn>
                    <TreeGridColumn Field="Title" HeaderText="Title" Width="260"></TreeGridColumn>
                    <TreeGridColumn Field="ContentType" HeaderText="Type" Width="160"></TreeGridColumn>
                    <TreeGridColumn Field="State" HeaderText="State" Width="160">
                        <Template>
                            @{
                                var ctx = (context as ContentItem);
                                var state = (ctx?.State ?? string.Empty)?.Trim();
                                var norm = state?.ToLowerInvariant();
                                string badgeClass = norm switch
                                {
                                    "published" => "state-badge state-published",
                                    "draft" => "state-badge state-draft",
                                    "archived" => "state-badge state-archived",
                                    "in review" => "state-badge state-review",
                                    _ => "state-badge state-archived"
                                };
                                string dotClass = norm switch
                                {
                                    "published" => "state-dot dot-published",
                                    "draft" => "state-dot dot-draft",
                                    "archived" => "state-dot dot-archived",
                                    "in review" => "state-dot dot-review",
                                    _ => "state-dot dot-archived"
                                };
                            }
                            <span class="@badgeClass" title="@state">
                                <span class="@dotClass"></span>
                                @state
                            </span>
                        </Template>
                    </TreeGridColumn>
                    <TreeGridColumn Field="Progress" HeaderText="Progress" Width="180" TextAlign="TextAlign.Left">
                        <Template>
                            @{
                                var ctx = (context as ContentItem);
                                int pct = Math.Max(0, Math.Min(100, ctx?.Progress ?? 0));
                            }
                            <div class="progress-cell">
                                <div class="progress-wrap">
                                    <div class="progress-bar" style="width:@pct%"></div>
                                </div>
                                <span class="progress-label">@pct%</span>
                            </div>
                        </Template>
                    </TreeGridColumn>
                    <TreeGridColumn Field="CreatedDate" HeaderText="Created" Format="d" Type="ColumnType.Date" Width="120"></TreeGridColumn>
                    <TreeGridColumn Field="UpdatedDate" HeaderText="Updated" Format="d" Type="ColumnType.Date" Width="120"></TreeGridColumn>
                </TreeGridColumns>
            </SfTreeGrid>
        </div>
    </div>
    <PropertyPanel ControlSecClass="col-lg-9" CollapseChanged="RefreshTreeGrid">
        <SfCheckBox @bind-Checked="@IsChecked"
                    @onchange="OnCheckboxChange"
                    Label="Load with Child">
        </SfCheckBox>
    </PropertyPanel>
</div>


<style>
    .state-badge {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 2px 10px;
        border-radius: 999px;
        font-size: inherit;
        font-weight: inherit;
        line-height: 20px;
        white-space: nowrap;
    }

    .state-published {
        background: #e6f7ec;
        color: #0f7a39;
        border: 1px solid #bfe7cd;
    }

    .state-draft {
        background: #fff3e6;
        color: #a14b00;
        border: 1px solid #ffd7ae;
    }

    .state-archived {
        background: #f2f4f7;
        color: #475467;
        border: 1px solid #e4e7ec;
    }

    .state-review {
        background: #e9f2ff;
        color: #0b5cab;
        border: 1px solid #c7ddff;
    }

    .state-dot {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        display: inline-block;
    }

    .dot-published {
        background: #17b26a;
    }

    .dot-draft {
        background: #f79009;
    }

    .dot-archived {
        background: #98a2b3;
    }

    .dot-review {
        background: #2e90fa;
    }

    /* Progress bar styles */
    .progress-wrap {
        width: 100%;
        height: 10px;
        background: #f2f4f7;
        border-radius: 999px;
        overflow: hidden;
        position: relative;
    }

    .progress-bar {
        height: 100%;
        background: linear-gradient(90deg, #2e90fa, #17b26a);
        transition: width 300ms ease;
    }

    .progress-label {
        font-size: inherit;
        color: #475467;
        margin-left: 8px;
    }

    .progress-cell {
        display: flex;
        align-items: center;
        gap: 8px;
    }
</style>

@code {
    public class ContentItem
    {
        public int ID { get; set; }
        public string? Title { get; set; }
        public DateTime CreatedDate { get; set; }
        public DateTime UpdatedDate { get; set; }
        public int Progress { get; set; }
        public string? State { get; set; }
        public string? ContentType { get; set; }
        public int? ParentItem { get; set; }
        public bool? isParent { get; set; }
    }

    private bool loadChildOnDemand { get; set; } = true;
    private bool IsChecked { get; set; } = false;
    private Query GridQuery { get; set; } = new Query().AddParams("loadchildondemand", false);
    private int GridPageSize { get; set; } = 12;

    private SfTreeGrid<ContentItem> treeGrid{ get; set; }

    public void OnCheckboxChange(ChangeEventArgs args)
    {
        var checkedVal = (bool)(args.Value ?? false);
        if (checkedVal)
        {
            GridPageSize = 6;
            GridQuery = new Query().AddParams("loadchildondemand", true);
            loadChildOnDemand = false;
        }
        else
        {
            GridPageSize = 12;
            GridQuery = new Query().AddParams("loadchildondemand", false);
            loadChildOnDemand = true;
        }
    }

    async void RefreshTreeGrid()
    {
        await treeGrid.RefreshAsync();
    }
}

