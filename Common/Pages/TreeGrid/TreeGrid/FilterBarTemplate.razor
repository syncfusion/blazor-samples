@page "/tree-grid/filter-bar-template"
@using Syncfusion.Blazor.TreeGrid
@using Syncfusion.Blazor.Grids
@using Syncfusion.Blazor.DropDowns
@using Syncfusion.Blazor.Inputs
@using Syncfusion.Blazor.Calendars

@*Hidden:Lines*@
@using TicketData
@*End:Hidden*@

<SampleDescription>
    <p>This sample demonstrates using filter bar templates in the Tree Grid to place custom inputs in filter cells. Columns can be filtered with Dropdown and DatePicker components instead of plain text fields, providing a more flexible filtering experience.</p>
</SampleDescription>

<ActionDescription>
    <p>Filter bar templates are enabled by defining the column <a aria-label="Navigate to the FilterTemplate property reference for tree grid column" target="_blank" href="https://help.syncfusion.com/cr/blazor/Syncfusion.Blazor.TreeGrid.TreeGridColumn.html#Syncfusion_Blazor_TreeGrid_TreeGridColumn_FilterTemplate">FilterTemplate</a> and turning on filtering by setting <a aria-label="Navigate to the allow filtering property reference to tree grid data in column" target="_blank" href="https://help.syncfusion.com/cr/blazor/Syncfusion.Blazor.TreeGrid.SfTreeGrid-1.html#Syncfusion_Blazor_TreeGrid_SfTreeGrid_1_AllowFiltering">AllowFiltering</a> property to <b>true</b>.</p>
    <p>In this demo, dropdowns are rendered for the "<b>Assigned To</b>", "<b>Category</b>", and "<b>Status</b>" columns, date pickers are used for "<b>Created Date</b>" and "<b>Due Date</b>", and entering a value filters the respective column. The Tree Grid also displays "<b>Ticket ID</b>", "<b>Title</b>", and "<b>Description</b>" with standard filter text boxes.</p>
    <p>More information about filter bar templates can be found in this <a aria-label="Navigate to the documentation for Filter bar template with custom component" target="_blank" href="https://blazor.syncfusion.com/documentation/treegrid/filtering/filter-bar#filter-bar-template-with-custom-component">documentation</a> section.</p>
</ActionDescription>

<div class="col-lg-12 control-section">
    <div class="content-wrapper">
        <div class="row">
            <SfTreeGrid @ref="TreeGridInstance"
                        DataSource="TreeGridData"
                        IdMapping="TicketID"
                        ParentIdMapping="ParentTicketID"
                        TreeColumnIndex="1"
                        Height="312"
                        AllowFiltering="true">
                <TreeGridColumns>
                    <TreeGridColumn Field="TicketID" HeaderText="Ticket ID" Width="110" TextAlign="TextAlign.Right"></TreeGridColumn>
                    <TreeGridColumn Field="Title" ClipMode="ClipMode.EllipsisWithTooltip" HeaderText="Title" Width="240"></TreeGridColumn>


                    <TreeGridColumn Field="AssignedAgent" HeaderText="Assigned To" Width="140">
                        <FilterTemplate>
                            <SfComboBox TItem="string" TValue="string"
                                        Placeholder="Select agent"
                                        DataSource="@Agents"
                                        @bind-Value="@AgentVal">
                                <ComboBoxEvents TItem="string" TValue="string" ValueChange="@OnAgentChange"></ComboBoxEvents>
                            </SfComboBox>
                        </FilterTemplate>
                    </TreeGridColumn>

                    <TreeGridColumn Field="Category" HeaderText="Category" Width="130">
                        <FilterTemplate>
                            <SfDropDownList TValue="string" Placeholder="Select Category" TItem="DropdownDataModel"
                                            DataSource="@CategoryDropdownData"
                                            @bind-Value="@DropValCategory">
                                <DropDownListEvents TValue="string" TItem="DropdownDataModel" ValueChange="@OnCategoryChange"></DropDownListEvents>
                                <DropDownListFieldSettings Text="Text" Value="Value"></DropDownListFieldSettings>
                            </SfDropDownList>
                        </FilterTemplate>
                    </TreeGridColumn>

                    <TreeGridColumn Field="Status" HeaderText="Status" Width="120">
                        <FilterTemplate>
                            <SfDropDownList TValue="string" Placeholder="Select Status" TItem="DropdownDataModel"
                                            DataSource="@StatusDropdownData"
                                            @bind-Value="@DropValStatus">
                                <DropDownListEvents TValue="string" TItem="DropdownDataModel" ValueChange="@OnStatusChange"></DropDownListEvents>
                                <DropDownListFieldSettings Text="Text" Value="Value"></DropDownListFieldSettings>
                            </SfDropDownList>
                        </FilterTemplate>
                    </TreeGridColumn>

                    <TreeGridColumn Field="CreatedDate" HeaderText="Created Date" Format="d" Type="ColumnType.Date" TextAlign="TextAlign.Right" Width="140">
                        <FilterTemplate>
                            <SfDatePicker TValue="DateTime?" @bind-Value="@CreatedDateVal">
                                <DatePickerEvents TValue="DateTime?" ValueChange="@OnCreatedDateChange"></DatePickerEvents>
                            </SfDatePicker>
                        </FilterTemplate>
                    </TreeGridColumn>

                    <TreeGridColumn Field="DueDate" HeaderText="Due Date" Format="d" Type="ColumnType.Date" TextAlign="TextAlign.Right" Width="110">
                        <FilterTemplate>
                            <SfDatePicker TValue="DateTime?" @bind-Value="@DueDateVal">
                                <DatePickerEvents TValue="DateTime?" ValueChange="@OnDueDateChange"></DatePickerEvents>
                            </SfDatePicker>
                        </FilterTemplate>
                    </TreeGridColumn>
                </TreeGridColumns>
            </SfTreeGrid>
        </div>
    </div>
</div>

@code {
    private SfTreeGrid<SupportTicketData>? TreeGridInstance;

    internal List<SupportTicketData> TreeGridData { get; set; } = new();
    protected override void OnInitialized()
    {
        TreeGridData = SupportTicketData.GetSupportTickets().ToList();
    }

    public class DropdownDataModel
    {
        public string? Text { get; set; }
        public string? Value { get; set; }
    }

    public List<DropdownDataModel> CategoryDropdownData { get; set; } = new()
    {
        new() { Text = "Technical", Value = "Technical" },
        new() { Text = "Software", Value = "Software" },
        new() { Text = "Hardware", Value = "Hardware" },
        new() { Text = "Support", Value = "Support" },
        new() { Text = "Network", Value = "Network" },
        new() { Text = "Security", Value = "Security" },
        new() { Text = "Performance", Value = "Performance" },
        new() { Text = "Backup", Value = "Backup" },
        new() { Text = "Mobile", Value = "Mobile" },
        new() { Text = "Integration", Value = "Integration" },
        new() { Text = "Clear", Value = "Clear" },
    };

    public List<DropdownDataModel> StatusDropdownData { get; set; } = new()
    {
        new() { Text = "Open", Value = "Open" },
        new() { Text = "Escalated", Value = "Escalated" },
        new() { Text = "In Progress", Value = "In Progress" },
        new() { Text = "Resolved", Value = "Resolved" },
        new() { Text = "Clear", Value = "Clear" },
    };

    private readonly List<string> Agents = new() { "Lisa Brown", "Tom Davis", "John Smith", "Sarah Johnson", "Mike Wilson"};

    // Bound values
    public string DropValCategory { get; set; }
    public string DropValStatus { get; set; }
    public string? AgentVal { get; set; }
    public DateTime? CreatedDateVal { get; set; }
    public DateTime? DueDateVal { get; set; }

    private async Task OnCategoryChange(Syncfusion.Blazor.DropDowns.ChangeEventArgs<string, DropdownDataModel> args)
    {
        if (DropValCategory == null)
        {
            DropValCategory = "";
            return;
        }

        if (args.Value == null || args.Value == "All")
        {
            DropValStatus = "All";
            await TreeGridInstance!.ClearFilteringAsync();
        }
        else if (args.Value == "Clear")
        {
            List<string> fields = new List<string> { "Category" };
            DropValCategory = "";
            await TreeGridInstance.ClearFilteringAsync(fields);
        }
        else
        {
            await TreeGridInstance!.FilterByColumnAsync("Category", "equal", args.Value);
        }
    }

    private async Task OnStatusChange(Syncfusion.Blazor.DropDowns.ChangeEventArgs<string, DropdownDataModel> args)
    {
        if (DropValStatus == null){
            DropValStatus = "";
            return;
        }

        if (args.Value == null || args.Value == "All")
        {
            DropValCategory = "All";
            await TreeGridInstance!.ClearFilteringAsync();
        }
        else if (args.Value == "Clear")
        {
            List<string> fields = new List<string> { "Status" };
            DropValStatus = "";
            await TreeGridInstance!.ClearFilteringAsync(fields);
        }
        else
        {
            await TreeGridInstance!.FilterByColumnAsync("Status", "equal", args.Value);
        }
    }

    private async Task OnAgentChange(Syncfusion.Blazor.DropDowns.ChangeEventArgs<string, string> args)
    {
        if (args.Value == null)
        {
            await TreeGridInstance!.ClearFilteringAsync();
        }
        else
        {
            await TreeGridInstance!.FilterByColumnAsync("AssignedAgent", "equal", args.Value);
        }
    }

    private async Task OnCreatedDateChange(Syncfusion.Blazor.Calendars.ChangedEventArgs<DateTime?> args)
    {
        if (args.Value == null)
        {
            await TreeGridInstance!.ClearFilteringAsync();
        }
        else
        {
            await TreeGridInstance!.FilterByColumnAsync("CreatedDate", "equal", args.Value);
        }
    }

    private async Task OnDueDateChange(Syncfusion.Blazor.Calendars.ChangedEventArgs<DateTime?> args)
    {
        if (args.Value == null)
        {
            await TreeGridInstance!.ClearFilteringAsync();
        }
        else
        {
            await TreeGridInstance!.FilterByColumnAsync("DueDate", "equal", args.Value);
        }
    }
}