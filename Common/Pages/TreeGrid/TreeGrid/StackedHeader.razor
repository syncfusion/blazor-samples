@page "/tree-grid/stacked-header"

@using Syncfusion.Blazor.TreeGrid
@using Syncfusion.Blazor.Grids
@using Syncfusion.Blazor.Inputs
@using Syncfusion.Blazor.DropDowns
@using Syncfusion.Blazor.Buttons
@*Hidden:Lines*@
@using BlazorDemos
@using TicketData
@inherits SampleBaseComponent
@*End:Hidden*@

<ActionDescription>
<p>This example demonstrates the Tree Grid component, which includes stacked headers and a customizable column chooser template.</p>
    
    <p>The Tree Grid columns can be stacked/grouped in order to show multiple levels of column headers. Stacked headers are created by defining a parent <a target="_blank" rel="noopener" href="https://help.syncfusion.com/cr/blazor/Syncfusion.Blazor.TreeGrid.TreeGridColumn.html">TreeGridColumn</a> and placing its child columns inside the <a target="_blank" rel="noopener" href="https://help.syncfusion.com/cr/blazor/Syncfusion.Blazor.TreeGrid.TreeGridColumns.html">TreeGridColumns</a> collection.</p>
    
    <p>In this demo, the columns are grouped into the following categories:</p>
    <ul>
        <li><b>Ticket</b> - Ticket ID, Title, Category</li>
        <li><b>Ownership</b> - Agent, Customer, Priority, Status</li>
        <li><b>Schedule</b> - Created, Due, Estimated Hours</li>
    </ul>
    
    <p>The column chooser template allows customizing the layout and managing column visibility using the <a target="_blank" rel="noopener" href="https://help.syncfusion.com/cr/blazor/Syncfusion.Blazor.TreeGrid.TreeGridColumnChooserSettings.html">TreeGridColumnChooserSettings</a> component.</p>
    
    <p>More information about <a target="_blank" rel="noopener" href="https://blazor.syncfusion.com/documentation/treegrid/columns/columns">Stacked Header</a> and <a target="_blank" rel="noopener" href="https://blazor.syncfusion.com/documentation/treegrid/columns/column-chooser#template-support-in-column-chooser">Column Chooser Template</a> can be found in this documentation section.</p>
</ActionDescription>




<div class="col-lg-12 control-section">
  <div class="content-wrapper">
    <div class="row">
      <SfTreeGrid ID="TreeColumnChooser" DataSource="@Tickets" IdMapping="TicketID" @ref="TreeGrid" ParentIdMapping="ParentTicketID" TreeColumnIndex="1" Height="420" ShowColumnChooser Toolbar="@(new List<string>(){"ColumnChooser"})">
      
        <TreeGridColumnChooserSettings>
                    <Template>
                        @{
                            if(initialGrid)
                            {
                                templateContext = context as ColumnChooserTemplateContext;
                            }
                        }

                        <div class="e-chooser">
                            @if (templateContext?.Columns != null &&  ShouldRenderGroup("Ticket", templateContext.Columns))
                            {
                                <GridColumnChooserItemGroup Title="Ticket">
                                    @foreach (var column in GetGroupColumns("Ticket", templateContext.Columns))
                                    {
                                        <GridColumnChooserItem Column="column"></GridColumnChooserItem>
                                    }
                                    </GridColumnChooserItemGroup>
                            }
                            @if (templateContext?.Columns != null &&  ShouldRenderGroup("OwnerShip", templateContext.Columns))
                            {
                                <GridColumnChooserItemGroup Title="OwnerShip">
                                    @foreach (var column in GetGroupColumns("OwnerShip", templateContext.Columns))
                                    {
                                        <GridColumnChooserItem Column="column"></GridColumnChooserItem>
                                    }
                                </GridColumnChooserItemGroup>
                            }
                            @if (templateContext?.Columns != null && ShouldRenderGroup("Schedule", templateContext.Columns))
                            {
                                <GridColumnChooserItemGroup Title="Schedule">
                                    @foreach (var column in GetGroupColumns("Schedule", templateContext.Columns))
                                    {
                                        <GridColumnChooserItem Column="column"></GridColumnChooserItem>
                                    }
                                </GridColumnChooserItemGroup>
                            }
                            @if(templateContext?.Columns == null)
                            {
                                <div class="e-innerdiv e-cc e-ccnmdiv">
                                    <span class="e-cc e-nmatch">No Matches found</span>
                                </div>
                            }
                        </div>
                    </Template>
                    <FooterTemplate>
                        @{
                            var templateContext = context as ColumnChooserFooterTemplateContext;
                            var visibles = templateContext?.Columns.Where(x => x.Visible).Select(x => x.HeaderText).ToArray();
                            var hiddens = templateContext?.Columns.Where(x => !x.Visible).Select(x => x.HeaderText).ToArray();
                        }
                        <SfButton IsPrimary="true" OnClick="@(async () => {
                        await TreeGrid?.ShowColumnsAsync(visibles)!;
                        await TreeGrid?.HideColumnsAsync(hiddens)!; initialGrid = true; cancelIcon = ""; searchText="";})">OK</SfButton>
                        <SfButton @onclick="@(async () =>{ await templateContext?.CancelAsync()!;initialGrid = true; cancelIcon = ""; searchText="";})">Cancel</SfButton>
                    </FooterTemplate>
                </TreeGridColumnChooserSettings>
        <TreeGridColumns>
          <!-- Ticket group -->
           <TreeGridColumn HeaderText=" Ticket" TextAlign="TextAlign.Center">
              <TreeGridColumns>
                            <TreeGridColumn Field="TicketID" HeaderText="Ticket ID" Width="110" TextAlign="TextAlign.Right"></TreeGridColumn>
                            <TreeGridColumn Field="Title" ClipMode="ClipMode.EllipsisWithTooltip" HeaderText="Title" Width="240"></TreeGridColumn>
                            <TreeGridColumn Field="Category" HeaderText="Category" Width="140"></TreeGridColumn>
              </TreeGridColumns>
          </TreeGridColumn>

          <!-- Ownership group -->
          <TreeGridColumn HeaderText="Ownership" TextAlign="TextAlign.Center">
              <TreeGridColumns>
                            <TreeGridColumn Field="AssignedAgent" HeaderText="Agent" Width="160"></TreeGridColumn>
                            <TreeGridColumn Field="CustomerName" HeaderText="Customer" Width="180"></TreeGridColumn>
                            <TreeGridColumn Field="Priority" HeaderText="Priority" Width="120"></TreeGridColumn>
                            <TreeGridColumn Field="Status" HeaderText="Status" Width="120"></TreeGridColumn>
              </TreeGridColumns>
          </TreeGridColumn>
          

          <!-- Schedule group -->
          <TreeGridColumn HeaderText="Schedule" TextAlign="TextAlign.Center">
              <TreeGridColumns >
                            <TreeGridColumn Field="CreatedDate" HeaderText="Created Date" Format="d" Type=ColumnType.Date Width="130" TextAlign="TextAlign.Right"></TreeGridColumn>
                            <TreeGridColumn Field="DueDate" HeaderText="Due Date" Format="d" Type=ColumnType.Date Width="130" TextAlign="TextAlign.Right"></TreeGridColumn>
                            <TreeGridColumn Field="EstimatedHours" HeaderText="Estimated (In Hours)" Width="120" ClipMode="ClipMode.EllipsisWithTooltip" TextAlign="TextAlign.Right"></TreeGridColumn>
              </TreeGridColumns>
          </TreeGridColumn>
          
        </TreeGridColumns>
      </SfTreeGrid>
    </div>
  </div>
</div>

@code {
    

    private List<SupportTicketData> Tickets { get; set; } = new();

    protected override void OnInitialized()
    {
        Tickets = SupportTicketData.GetSupportTickets();
    }

    SfTreeGrid<SupportTicketData>? TreeGrid { get; set; }

    SfTextBox? textBox { get; set; }

    private ColumnChooserTemplateContext? templateContext { get; set; }


    private string cancelIcon { get; set; } = "";

    private string? searchText { get; set; }

    private bool initialGrid = true;

    IDictionary<string, string[]> groups = new Dictionary<string, string[]>()
    {
        { "Ticket", new string[] { "TicketID","Title", "Category" } }, { "OwnerShip", new string[]{ "AssignedAgent", "CustomerName", "Priority", "Status" } }, { "Schedule", new string[]{ "CreatedDate", "DueDate", "EstimatedHours" } }
    };

    private bool ShouldRenderGroup(string title, List<GridColumn> columns)
    {
        return groups[title].Any(x => columns.Any(y => y.Field.Split('.')[1] == x));
    }
    private List<GridColumn> GetGroupColumns(string title, List<GridColumn> columns)
    {
        return columns.Where(x => groups[title].Contains(x.Field.Split('.')[1])).ToList();
    }
}

@*Hidden:Lines*@
<style>
    #TreeColumnChooser .e-grid .e-ccdlg .e-dlg-content{
            margin: -20px 0 0 !important;
    }
</style>
@*End:Hidden*@