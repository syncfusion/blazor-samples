@page "/tree-grid/aggregate"

@using Syncfusion.Blazor.TreeGrid
@using Syncfusion.Blazor.Grids
@using Syncfusion.Blazor.Navigations
@*Hidden:Lines*@
@inherits SampleBaseComponent;
@using Summarydata
@*End:Hidden*@

<SampleDescription>
    <p>
        This sample demonstrates the aggregate functionality in Tree Grid. Aggregates are displayed in the footer to summarize key metrics such as total, average, and count.
    </p>
</SampleDescription>

<ActionDescription>
    <p>
        Aggregates in Tree Grid are configured using the <a target="_blank" href="https://help.syncfusion.com/cr/blazor/Syncfusion.Blazor.TreeGrid.TreeGridAggregateColumn.html">TreeGridAggregateColumn</a> inside the <a target="_blank" href="https://help.syncfusion.com/cr/blazor/Syncfusion.Blazor.TreeGrid.TreeGridAggregates.html">TreeGridAggregates</a> collection.
    </p>

    <p>
        Tree Grid supports the following built-in aggregate types:
    </p>
    <ul>
        <li><code>Sum</code></li>
        <li><code>Average</code></li>
        <li><code>Min</code></li>
        <li><code>Max</code></li>
        <li><code>Count</code></li>
        <li><code>TrueCount</code></li>
        <li><code>FalseCount</code></li>
    </ul>

    <p>
        In this demo, the <a target="_blank" href="https://help.syncfusion.com/cr/blazor/Syncfusion.Blazor.TreeGrid.TreeGridAggregateColumn.html#Syncfusion_Blazor_TreeGrid_TreeGridAggregateColumn_FooterTemplate">FooterTemplate</a> property is used to display the following summaries:
    </p>
    <ul>
        <li><b>"Total Sales"</b> and <b>"Total Profit"</b> are calculated using the <code>Sum</code> aggregate type to show the overall revenue and earnings across all records.</li>
        <li><b>"Average Unit Price"</b> is calculated using the <code>Average</code> aggregate type to reflect the mean cost per unit.</li>
        <li><b>"Item Count"</b> is calculated using the <code>Count</code> aggregate type to display the total number of product entries.</li>
    </ul>
    <p>
        Aggregates are shown at the bottom of the grid and also include child summaries using the <code>ShowChildSummary</code> property.
    </p>

    <p>
        More information about aggregates in Tree Grid can be found in this 
        <a target="_blank" href="https://blazor.syncfusion.com/documentation/treegrid/aggregate/">documentation</a> section.
    </p>
</ActionDescription>


<div class="col-lg-12 control-section">
    <div class="content-wrapper">
        <div class="row">
            <SfTreeGrid TValue="SalesNode"
                        DataSource="@Data"
                        IdMapping="Id"
                        ParentIdMapping="ParentId"
                        TreeColumnIndex="1"
                        AllowSorting="true"
                        AllowFiltering="true"
                        AllowReordering="true"
                        Height="550px"
                        @ref="treeRef">

                <TreeGridFilterSettings Type="Syncfusion.Blazor.TreeGrid.FilterType.Menu" HierarchyMode="FilterHierarchyMode.Both"></TreeGridFilterSettings>
                <TreeGridEvents TValue="SalesNode" OnToolbarClick="OnToolbarClick">
                </TreeGridEvents>
                <TreeGridColumns>
                    <TreeGridColumn ShowInColumnChooser="false" Field="Id" HeaderText="ID" Width="90" TextAlign="TextAlign.Right" Visible="false"></TreeGridColumn>
                    <TreeGridColumn Field="Name" HeaderText="Name" Width="250"></TreeGridColumn>
                    <TreeGridColumn Field="Category" HeaderText="Category" Width="140"></TreeGridColumn>
                    <TreeGridColumn Field="Product" HeaderText="Product" Width="180"></TreeGridColumn>
                    <TreeGridColumn Field="Units" HeaderText="Units" Width="110" TextAlign="TextAlign.Right" Type="ColumnType.Integer"></TreeGridColumn>
                    <TreeGridColumn Field="UnitPrice" HeaderText="Unit Price" Width="180" TextAlign="TextAlign.Right" Format="C2" Type="ColumnType.Integer"></TreeGridColumn>
                    <TreeGridColumn Field="Sales" HeaderText="Sales" Width="180" TextAlign="TextAlign.Right" Format="C0" Type="ColumnType.Integer"></TreeGridColumn>
                    <TreeGridColumn Field="Profit" HeaderText="Profit" Width="180" TextAlign="TextAlign.Right" Format="C0" Type="ColumnType.Integer"></TreeGridColumn>
                    <TreeGridColumn Field="MarginPct" HeaderText="Margin" Width="160" TextAlign="TextAlign.Right" Format="P1" Type="ColumnType.Integer"></TreeGridColumn>
                </TreeGridColumns>
                <TreeGridAggregates>
                    <TreeGridAggregate ShowChildSummary="true">
                        <TreeGridAggregateColumns>
                            <TreeGridAggregateColumn Field="Sales" Type="@(AggregateType.Sum)" Format="C0">
                                <FooterTemplate>
                                    @($"Total Sales: {(context as Syncfusion.Blazor.Grids.AggregateTemplateContext).Sum}")
                                </FooterTemplate>
                            </TreeGridAggregateColumn>
                            <TreeGridAggregateColumn Field="Profit" Type="@(AggregateType.Sum)" Format="C0">
                                <FooterTemplate>
                                    @($"Total Profit: {(context as Syncfusion.Blazor.Grids.AggregateTemplateContext).Sum}")
                                </FooterTemplate>
                            </TreeGridAggregateColumn>
                            <TreeGridAggregateColumn Field="UnitPrice" Type="@(AggregateType.Average)" Format="C2">
                                <FooterTemplate>
                                    @($"Avg Unit Price: {(context as Syncfusion.Blazor.Grids.AggregateTemplateContext).Average}")
                                </FooterTemplate>
                            </TreeGridAggregateColumn>
                            <TreeGridAggregateColumn Field="Product" Type="@(AggregateType.Count)">
                                <FooterTemplate>
                                    @($"Items: {(context as Syncfusion.Blazor.Grids.AggregateTemplateContext).Count}")
                                </FooterTemplate>
                            </TreeGridAggregateColumn>
                        </TreeGridAggregateColumns>
                    </TreeGridAggregate>
                </TreeGridAggregates>
            </SfTreeGrid>
        </div>
    </div>
</div>

@code {

    private List<SalesNode> Data { get; set; } = new();

    protected override void OnInitialized()
    {
        // Use self-referential flat data with Id/ParentId mapping
        Data = RetailDataFactory.CreateFlat();
    }

    // Toolbar actions: trigger export
    private SfTreeGrid<SalesNode>? treeRef;
    private async Task OnToolbarClick(ClickEventArgs args)
    {
        if (treeRef is null) return;
        if (args.Item.Id?.Contains("excelexport", StringComparison.OrdinalIgnoreCase) == true)
        {
            await treeRef.ExportToExcelAsync();
        }
        else if (args.Item.Id?.Contains("pdfexport", StringComparison.OrdinalIgnoreCase) == true)
        {
            await treeRef.ExportToPdfAsync();
        }
    }
}
