@page "/pivot-table/export-as-pivot"
@using Syncfusion.Blazor.PivotView
@using Syncfusion.Blazor.Buttons
@using Syncfusion.Blazor.Navigations
@using Syncfusion.Blazor
@*Hidden:Lines*@
@using ThemeHelper
@inherits SampleBaseComponent;
@*End:Hidden*@
@inject NavigationManager NavigationManager

<ActionDescription>
<p>This sample demonstrates exporting a server-side Syncfusion Pivot Table as a fully interactive Excel Pivot Table.</p>
    
    <p>Key features:</p>
    
    <ul>
        <li>Export to Excel while preserving native pivot structure</li>
        <li>Support for full interactivity in exported Excel file</li>
        <li>Users customize pivot configurations directly in Excel</li>
        <li>Server-side pivot engine powered by <a target="_blank" rel="noopener" href="https://www.nuget.org/packages/Syncfusion.Pivot.Engine/" aria-label="NuGet package reference of Pivot Engine">Syncfusion.Pivot.Engine</a> package</li>
    </ul>
    
    <p>Server-side pivot engine performs operations including <a target="_blank" rel="noopener" href="https://blazor.syncfusion.com/documentation/pivot-table/aggregation" aria-label="Blazor PivotTable Aggregation documentation">aggregation</a>, <a target="_blank" rel="noopener" href="https://blazor.syncfusion.com/documentation/pivot-table/filtering" aria-label="Blazor PivotTable Filtering documentation">filtering</a>, <a target="_blank" rel="noopener" href="https://blazor.syncfusion.com/documentation/pivot-table/sorting" aria-label="Blazor PivotTable Sorting documentation">sorting</a>, and <a target="_blank" rel="noopener" href="https://blazor.syncfusion.com/documentation/pivot-table/grouping" aria-label="Blazor PivotTable Grouping documentation">grouping</a> on remote server, returning only paged data to client.</p>
    
    <p>Configuration via <a target="_blank" rel="noopener" href="https://help.syncfusion.com/cr/blazor/Syncfusion.Blazor.PivotView.IPivotViewDataSourceSettings.html#Syncfusion_Blazor_PivotView_IPivotViewDataSourceSettings_Url" aria-label="Class reference of DataSourceSettings property in PivotView">DataSourceSettings->Url</a> property.</p>
    
    <p>For comprehensive documentation, refer to the <a target="_blank" rel="noopener" href="https://blazor.syncfusion.com/documentation/pivot-table/server-side-pivot-engine">server-side aggregation documentation</a>.</p>
</ActionDescription>


<div class="control-section">
    <div class="content-wrapper">
        <SfPivotView TValue="SalesAnalysis" Width="100%" Height="450" @ref="pivotView" ShowToolbar="true" Toolbar="@PivotToolbar" AllowExcelExport="true" AllowPdfExport="true" AllowDataCompression="true" ShowFieldList="true" ShowGroupingBar="true">
            <PivotViewEvents TValue="SalesAnalysis" ToolbarRendered="ToolbarRender"></PivotViewEvents>
            <PivotViewDataSourceSettings TValue="SalesAnalysis" Url="https://blazor.syncfusion.com/services/production/api/pivotengine/post" EnableServerSideAggregation="true" ExpandAll="true" EnableSorting="true">
                <PivotViewRows>
                    <PivotViewRow Name="Country"></PivotViewRow>
                    <PivotViewRow Name="Products"></PivotViewRow>
                </PivotViewRows>
                <PivotViewColumns>
                    <PivotViewColumn Name="Year" Caption="Production Year"></PivotViewColumn>
                </PivotViewColumns>
                <PivotViewValues>
                    <PivotViewValue Name="Sold" Caption="Units Sold"></PivotViewValue>
                    <PivotViewValue Name="Amount" Caption="Sold Amount"></PivotViewValue>
                </PivotViewValues>
                <PivotViewFormatSettings>
                    <PivotViewFormatSetting Name="Amount" Format="C0"></PivotViewFormatSetting>
                    <PivotViewFormatSetting Name="Sold" Format="N0"></PivotViewFormatSetting>
                </PivotViewFormatSettings>
            </PivotViewDataSourceSettings>
            <PivotViewDisplayOption View=View.Both></PivotViewDisplayOption>
            <PivotChartSettings Title="Sales Analysis" Theme="@Theme">
                <PivotChartLegendSettings Visible="false"></PivotChartLegendSettings>
                <PivotChartSeries>
                    <PivotChartSeriesAnimation Enable="false"></PivotChartSeriesAnimation>
                </PivotChartSeries>
                <PivotChartPrimaryYAxis>
                    <PivotChartPrimaryYAxisBorder Width="0"></PivotChartPrimaryYAxisBorder>
                </PivotChartPrimaryYAxis>
            </PivotChartSettings>
        </SfPivotView>
    </div>
</div>

@code{
    private SfPivotView<SalesAnalysis>? pivotView;
    public List<Syncfusion.Blazor.PivotView.ToolbarItems> PivotToolbar = new List<Syncfusion.Blazor.PivotView.ToolbarItems>
    {
        Syncfusion.Blazor.PivotView.ToolbarItems.Grid,
        Syncfusion.Blazor.PivotView.ToolbarItems.Chart,
        Syncfusion.Blazor.PivotView.ToolbarItems.FieldList
    };
    private Theme Theme { get; set; }
    public void ToolbarRender(ToolbarArgs args)
    {
        // Insert Excel Export button at the beginning of the toolbar
        args.CustomToolbar.Insert(0, new ItemModel
            {
                PrefixIcon = "e-menu-icon e-pivotview-excel-export e-icons",
                TooltipText = "Excel Export as Pivot",
                Click = EventCallback.Factory.Create<ClickEventArgs>(this, ButtonClick)
            });
            // Add separator after Excel Export button
        args.CustomToolbar.Insert(1, new ItemModel()
        {
            Type = ItemType.Separator
        });
         args.CustomToolbar.Insert(3, new ItemModel()
        {
            Type = ItemType.Separator
        });
    }
    public void ButtonClick(ClickEventArgs args)
    {
        if(pivotView != null)
        {
            this.pivotView.ExportAsPivotAsync(ExportType.Excel);
        }
    }  
      protected override void OnInitialized()
    {
        Theme = ThemeHelper.GetCurrentTheme(NavigationManager.Uri);
    }  
}