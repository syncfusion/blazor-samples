@page "/datagrid/reactive-aggregate"

@using Syncfusion.Blazor.Grids
@*Hidden:Lines*@
@using blazor_orderdata
@inherits SampleBaseComponent
@inject NavigationManager NavigationManager


@*End:Hidden*@

<ActionDescription>
<p>This sample demonstrates reactive aggregate functionality that updates grid aggregated data in real-time during batch editing.</p>
  
  <p>The Blazor DataGrid supports reactive aggregate updates, which automatically refresh aggregate values in the footer, group footer, and group caption sections as data changes.</p>
  
  <p>In this demo:</p>
  <ul>
    <li>Batch editing mode is enabled</li>
    <li>Aggregate values are displayed in the grid footer</li>
    <li>When you edit the Freight value cells, the corresponding aggregate values update automatically</li>
    <li>The reactive update provides immediate visual feedback of aggregate changes</li>
  </ul>
  
  <p><strong>Important Note:</strong> Reactive aggregate updates are supported only in batch edit mode. Inline and dialog edit modes do not automatically update aggregates during editing.</p>
  
  <p>This feature is particularly useful when you need to provide users with real-time feedback on aggregate calculations as they modify data in the grid.</p>
</ActionDescription>



<div class="col-lg-12 control-section">
    <div class="content-wrapper">
        <div class="row">
          <SfGrid DataSource="@Orders" AllowPaging="true" AllowSorting="true" AllowGrouping=true Toolbar="@ToolbarItems">
             <GridEditSettings  AllowDeleting="true" AllowEditing="true" Mode="EditMode.Batch"></GridEditSettings>
             <GridGroupSettings ShowDropArea="false" Columns=@Units></GridGroupSettings>
             <GridAggregates>
                  <GridAggregate>
                    <GridAggregateColumns>
                        <GridAggregateColumn Field=@nameof(OrderData.Freight) Type="AggregateType.Sum" Format="C2">
                            <GroupFooterTemplate>
                                @{
                                    var aggregate = (context as AggregateTemplateContext);
                                    <div>
                                        <p>Sum: @aggregate?.Sum</p>
                                    </div>
                                }
                            </GroupFooterTemplate>
                        </GridAggregateColumn>
                        <GridAggregateColumn Field=@nameof(OrderData.Freight) Type="AggregateType.Sum" Format="C2">
                            <FooterTemplate>
                                @{
                                    var aggregate = (context as AggregateTemplateContext);
                                    <div>
                                        <p>Total: @aggregate?.Sum</p>
                                    </div>
                                }
                            </FooterTemplate>
                        </GridAggregateColumn>
               
                        <GridAggregateColumn Field=@nameof(OrderData.Freight) Type="AggregateType.Average" Format="C2">
                            <GroupCaptionTemplate>
                                @{
                                    var aggregate = (context as AggregateTemplateContext);
                                    <div>
                                        Average: @aggregate?.Average
                                    </div>
                                }
                            </GroupCaptionTemplate>
                        </GridAggregateColumn>
                        <GridAggregateColumn Field=@nameof(OrderData.Verified) Type="AggregateType.TrueCount">
                            <GroupFooterTemplate>
                                @{
                                    var Count = (context as AggregateTemplateContext);
                                    <div>
                                        <p>Verified: @Count?.TrueCount</p>
                                    </div>
                                }
                            </GroupFooterTemplate>
                        </GridAggregateColumn>
                      </GridAggregateColumns>
                    </GridAggregate>
             </GridAggregates>
    
             <GridColumns>
                 <GridColumn Field=@nameof(OrderData.OrderID) HeaderText="Order ID" IsPrimaryKey=true TextAlign="TextAlign.Right" Width="120"></GridColumn>
                 <GridColumn Field=@nameof(OrderData.CustomerID) HeaderText="Customer Name" Width="150"></GridColumn>
                 <GridColumn Field=@nameof(OrderData.Freight) HeaderText="Freight" Format="C2" TextAlign="TextAlign.Right" Width="160"></GridColumn>
                 <GridColumn Field=@nameof(OrderData.OrderDate) HeaderText=" Order Date" Format="d" Type="ColumnType.Date" TextAlign="TextAlign.Right" Width="130"></GridColumn>
                 <GridColumn Field=@nameof(OrderData.ShipCountry) HeaderText="Ship Country" Width="140"></GridColumn>
                 <GridColumn Field=@nameof(OrderData.Verified)  DisplayAsCheckBox=@true HeaderText="Verified" Width="140" EditType="EditType.BooleanEdit" Type="ColumnType.Boolean"></GridColumn>
           </GridColumns>
        </SfGrid>
        </div>
    </div>
</div>

@code
{
    private List<string> ToolbarItems = new List<string>(){ "Delete","Update","Cancel"};
    public List<OrderData>? Orders { get; set; }
    private string[] Units = (new string[] { "CustomerID" });
    

    protected override void OnInitialized()
    {
        
        Orders = OrderData.GetAllRecords();
    }
}