@page "/datagrid/observable-binding"

@using Syncfusion.Blazor.Grids
@using Syncfusion.Blazor.Buttons
@using System.Collections.ObjectModel;
@using System.ComponentModel;
@*Hidden:Lines*@
@using BlazorDemos
@using blazor_griddata
@inherits SampleBaseComponent
@inject NavigationManager NavigationManager


@*End:Hidden*@

<ActionDescription>
<p>This sample demonstrates observable collection data binding in the DataGrid component for dynamic data updates.</p>
  
  <p>Observable collections provide automatic change notification when objects are added, removed, or updated. The DataGrid UI is automatically updated when changes occur in the observable collection:</p>
  <ul>
    <li>When an object is added to the collection, it automatically appears in the grid</li>
    <li>When an object is removed, it disappears from the grid</li>
    <li>When a collection is modified, the grid reflects these changes without manual refresh</li>
  </ul>
  
  <p>To refresh the UI for single property updates, configure the property setter appropriately in your model class. This ensures that property changes trigger UI updates in the DataGrid.</p>
  
  <p>For more detailed information about observable collection data binding, refer to the <a target='_blank' href='https://blazor.syncfusion.com/documentation/datagrid/data-binding/#observable-collection' aria-label="Navigate to the documentation for Observable collection in DataGrid component">observable collection documentation</a>.</p>
</ActionDescription>


<div class="col-lg-12 control-section">
    <div class="content-wrapper">
        <div class="row">
            <div style="padding-bottom: 10px;">
                <SfButton ID="add" @onclick="AddRecord">Add Data</SfButton>
                <SfButton ID="del" @onclick="DeleteRecord">Delete Data</SfButton>
                <SfButton ID="update" @onclick="UpdateRecord">Update Data</SfButton>
            </div>
            <SfGrid DataSource="@ObservableData" AllowPaging="true">
                <GridColumns>
                    <GridColumn Field=@nameof(ObservableDatas.OrderID) HeaderText="Order ID" IsPrimaryKey="true" TextAlign="@TextAlign.Center" HeaderTextAlign="@TextAlign.Center" Width="140"></GridColumn>
                    <GridColumn Field=@nameof(ObservableDatas.CustomerID) HeaderText="Customer ID" Width="150"></GridColumn>
                    <GridColumn Field=@nameof(ObservableDatas.Freight) HeaderText="Freight" EditType="EditType.NumericEdit" Format="C2" Width="140" TextAlign="@TextAlign.Right" HeaderTextAlign="@TextAlign.Right"></GridColumn>
                    <GridColumn Field=@nameof(ObservableDatas.OrderDate) HeaderText="Order Date" EditType="EditType.DatePickerEdit" Format="d" TextAlign="TextAlign.Right" Type="ColumnType.Date" Width="160"></GridColumn>
                </GridColumns>
            </SfGrid>
        </div>
    </div>
</div>

@code{

    public ObservableCollection<ObservableDatas>? ObservableData { get; set; }

    List<ObservableDatas> Orders = new List<ObservableDatas>();

    private int uniqueid { get; set; }
    

    protected override void OnInitialized()
    {
        
        ObservableData = GetAllRecords();
    }

    public static ObservableCollection<ObservableDatas> GetAllRecords()
    {
        ObservableCollection<ObservableDatas> customers = new ObservableCollection<ObservableDatas>();
        string[] CustomerName = { "ALFKI", "ANANTR", "ANTON", "BLONP", "BOLID" };
        double[] Freight = { 34.7, 26.7, 27.7, 29.7, 33.7 };
        DateTime[] OrderDate = { new DateTime(2023, 8, 1), new DateTime(2023, 8, 5), new DateTime(2023, 8, 10), new DateTime(2023, 8, 15), new DateTime(2023, 8, 20)};

        int OrderID = 10000;
        int i = 0; int k = 0; int j = 0;
        for (int x = 0; x < 10; x++)
        {
            i = i >= CustomerName.Length ? 0 : i;
            k = k >= Freight.Length ? 0 : k;
            j = j >= OrderDate.Length ? 0 : j;
            customers.Add(new ObservableDatas()
            {
                OrderID = OrderID + x,
                CustomerID = CustomerName[i],
                OrderDate = OrderDate[j],
                Freight = Freight[k],
            });
            i++; k++;j++;
        }
        return customers;
    }

    public void AddRecord()
    {
        ObservableData?.Add(new ObservableDatas() { OrderID = 10010 + ++uniqueid, CustomerID = "VINET", Freight = 30.35, OrderDate = new DateTime(1991, 05, 15) });
    }

    public void DeleteRecord()
    {
        if (ObservableData?.Count() != 0)
        {
            ObservableData?.Remove(ObservableData.First());
        }
    }

    public void UpdateRecord()
    {
        if (ObservableData?.Count() != 0)
        {
            var name = ObservableData?.First();
            if(name != null)
            name.CustomerID = "Record Updated";
        }
    }

    public class ObservableDatas : INotifyPropertyChanged
    {
        public int OrderID { get; set; }
        private string? customerID { get; set; }
        public string CustomerID
        {
            get { return customerID!; }
            set
            {
                this.customerID = value;
                NotifyPropertyChanged("CustomerID");
            }
        }
        public DateTime OrderDate { get; set; }
        public double Freight { get; set; }
        public event PropertyChangedEventHandler? PropertyChanged;
        private void NotifyPropertyChanged(string propertyName)
        {
            var handler = PropertyChanged;
            if (handler != null)
            {
                handler(this, new PropertyChangedEventArgs(propertyName));
            }
        }
    }
}