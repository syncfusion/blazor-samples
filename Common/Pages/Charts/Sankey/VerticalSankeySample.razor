@page "/sankey/vertical"
@using Syncfusion.Blazor
@using Syncfusion.Blazor.Sankey
@*Hidden:Lines*@
@using ThemeHelper
@*End:Hidden*@
@inject NavigationManager NavigationManager
@*Hidden:Lines*@
@inherits SampleBaseComponent
@*End:Hidden*@

<ActionDescription>
<p>This Sankey chart maps global coffee production and consumption from varieties (Arabica and Robusta) through processing stages to final products and regional demand in a vertical flow layout.</p>

<p>Analysis capabilities:</p>
<ul>
  <li>Hover over nodes to review production volumes at each stage</li>
  <li>Follow links to understand production-consumption dynamics</li>
  <li>Visualize distribution across different regions</li>
  <li>Identify key flow patterns in the supply chain</li>
</ul>

<p>Learn more about Sankey: <a target="_blank" rel="noopener" href="https://blazor.syncfusion.com/documentation/sankey" aria-label="Navigate to the documentation for Sankey chart">documentation section</a>.</p>
</ActionDescription>



<div class="control-section" align='center'>
    <SfSankey BackgroundColor="@_backgroundColor" EnableAnimation="false" Nodes=@Nodes Links=@Links Title="@_title" Orientation="SankeyOrientation.Vertical" Width="@_width" Height="450px" Theme="@_theme" LabelRendering="OnLabelRendering">
       <SankeyLegendSettings Visible="true" Position="@_position"></SankeyLegendSettings>
        <SankeyTooltipSettings Enable="true">
        </SankeyTooltipSettings>
    </SfSankey>
</div>

@code {
    Theme _theme;
    string _backgroundColor = "transparent";
    string _width = "70%";
    private string _title = "Global Coffee Production and Consumption Flow (Million 60kg bags)";
    SankeyLegendPosition _position = SankeyLegendPosition.Right;
    public List<SankeyDataNode> Nodes = new List<SankeyDataNode>();
    public List<SankeyDataLink> Links = new List<SankeyDataLink>();

    protected override void OnInitialized()
    {
        _theme = ThemeHelper.GetCurrentTheme(NavigationManager.Uri);
        string themeName = _theme.ToString().ToLower();
        _backgroundColor = (themeName.IndexOf("dark") > -1 || themeName.IndexOf("contrast") > -1) ? "transparent" : null!;
        Nodes = new List<SankeyDataNode>()
        {
            new SankeyDataNode() { Id = "Coffee Production" },
            new SankeyDataNode() { Id = "Arabica" },
            new SankeyDataNode() { Id = "Robusta" },
            new SankeyDataNode() { Id = "Roasted Coffee" },
            new SankeyDataNode() { Id = "Instant Coffee" },
            new SankeyDataNode() { Id = "Green Coffee" },
            new SankeyDataNode() { Id = "North America" },
            new SankeyDataNode() { Id = "Europe" },
            new SankeyDataNode() { Id = "Asia Pacific" },
        };

        Links = new List<SankeyDataLink>()
        {
            new SankeyDataLink() { SourceId = "Coffee Production", TargetId = "Arabica", Value = 95 },
            new SankeyDataLink() { SourceId = "Coffee Production", TargetId = "Robusta", Value = 65 },

            new SankeyDataLink() { SourceId = "Arabica", TargetId = "Roasted Coffee", Value = 60 },
            new SankeyDataLink() { SourceId = "Arabica", TargetId = "Instant Coffee", Value = 20 },
            new SankeyDataLink() { SourceId = "Arabica", TargetId = "Green Coffee", Value = 15 },

            new SankeyDataLink() { SourceId = "Robusta", TargetId = "Roasted Coffee", Value = 30 },
            new SankeyDataLink() { SourceId = "Robusta", TargetId = "Instant Coffee", Value = 25 },
            new SankeyDataLink() { SourceId = "Robusta", TargetId = "Green Coffee", Value = 10 },

            new SankeyDataLink() { SourceId = "Roasted Coffee", TargetId = "North America", Value = 35 },
            new SankeyDataLink() { SourceId = "Roasted Coffee", TargetId = "Europe", Value = 30 },
            new SankeyDataLink() { SourceId = "Roasted Coffee", TargetId = "Asia Pacific", Value = 25 },

            new SankeyDataLink() { SourceId = "Instant Coffee", TargetId = "North America", Value = 15 },
            new SankeyDataLink() { SourceId = "Instant Coffee", TargetId = "Europe", Value = 15 },
            new SankeyDataLink() { SourceId = "Instant Coffee", TargetId = "Asia Pacific", Value = 15 },

            new SankeyDataLink() { SourceId = "Green Coffee", TargetId = "North America", Value = 10 },
            new SankeyDataLink() { SourceId = "Green Coffee", TargetId = "Europe", Value = 8 },
            new SankeyDataLink() { SourceId = "Green Coffee", TargetId = "Asia Pacific", Value = 7 },
        };
        base.OnInitialized();
        @*Hidden:Lines*@
        if (SampleService != null && SampleService.IsDevice)
        {
            _width = "100%";
            _position = SankeyLegendPosition.Bottom;
            StateHasChanged();
        }
        @*End:Hidden*@
    }
 
    void OnLabelRendering(SankeyLabelRenderEventArgs args)
    {
        @*Hidden:Lines*@
        if (SampleService != null && SampleService.IsDevice)
        {
            args.Text = args.Text.Substring(0, 3).ToUpper();
        }
        @*End:Hidden*@
    }
}

