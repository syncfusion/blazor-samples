@page "/block-editor/events"

@*Hidden:Lines*@
@using Syncfusion.Blazor.BlockEditor;
@using Syncfusion.Blazor.BlockEditorDemo;
@using Syncfusion.Blazor.Buttons;
@inherits SampleBaseComponent
@*End:Hidden*@
<div class="col-lg-8 control-section sb-property-border">
    <div class="blockeditor-events">
        <SfBlockEditor @ref="ApiBlockEditor"
                       ID="events-blockeditor"
                       Blocks="BlockDataEvents"
                       Height="600px"
                       Created="@(args => LogEvent("Created"))"
                       Focus="@(args => LogEvent("Focus"))"
                       Blur="@(args => LogEvent("Blur"))"
                       BlockChanged="OnBlockChanged"
                       SelectionChanged="@(args => LogEvent("SelectionChanged"))">
            <BlockEditorInlineToolbar Items="InlineToolbarSettings"
                                              Enable="true"
                                              ItemClick="@OnToolbarItemClick"/>
        </SfBlockEditor>
    </div>
</div>
<div class="col-lg-4 property-section events-blockeditor">
    <div class="property-panel-header">Event Trace</div>
    <div class="property-panel-content">
        <table id="property" title="Event Trace" class="property-panel-table">
            <tbody>
                <tr>
                    <td>
                        <div class="eventarea" style="height: 245px; overflow: auto">
                            <div id="eventLog">
                                @foreach (var entry in EventLogEntries)
                                {
                                    <span>@((MarkupString)entry)</span>
                                }
                            </div>
                        </div>
                    </td>
                </tr>
                <tr>
                    <td>
                        <div class="evtbtn" style="padding-bottom: 10px">
                            <SfButton @ref="ClearButton" ID="clear" Content="Clear" OnClick="ClearLog"></SfButton>
                        </div>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
</div>
@code {
    private SfBlockEditor? ApiBlockEditor;
    private SfButton? ClearButton;
    // Data binding
    private List<BlockModel> BlockDataEvents = new();
    // Inline toolbar settings
    private List<InlineToolbarItemModel> InlineToolbarSettings = new();
    // Event log storage
    private List<string> EventLogEntries = new();
    protected override void OnInitialized()
    {
        // Initialize block data
        var dataProvider = new EditorBlockData();
        BlockDataEvents = dataProvider.GetBlockDataEvents();
    }
    private Task OnToolbarItemClick(InlineToolbarItemClickEventArgs args)
    {
        AppendElement($"BlockEditor inline toolbar <b>{args.Item?.ID}</b> clicked<hr>");
        return Task.CompletedTask;
    }
    //included after the version updated
    private Task OnBlockChanged(BlockChangedEventArgs args)
    {
        if (args?.Changes == null || args.Changes.Count == 0)
            return Task.CompletedTask;
        var counts = new Dictionary<BlockAction, int>();
        foreach (var change in args.Changes)
        {
            counts[change.Action] = (counts.TryGetValue(change.Action, out var v) ? v : 0) + 1;
        }
        string Plural(int n, string noun) => n == 1 ? $"{n} {noun}" : $"{n} {noun}s";
        var messages = new List<string>();
        if (counts.TryGetValue(BlockAction.Insertion, out var ins)) messages.Add($"{Plural(ins, "block")} inserted");
        if (counts.TryGetValue(BlockAction.Deletion, out var del)) messages.Add($"{Plural(del, "block")} deleted");
        if (counts.TryGetValue(BlockAction.Moved, out var mov)) messages.Add($"{Plural(mov, "block")} moved");
        if (counts.TryGetValue(BlockAction.Update, out var upd)) messages.Add($"{Plural(upd, "block")} updated");
        var logMessage = "BlockEditor <b>BlockChanged</b> event called: " + string.Join(", ", messages) + "<hr>";
        AppendElement(logMessage);
        return Task.CompletedTask;
    }
    // Generic event logger
    private void LogEvent(string eventName)
    {
        AppendElement($"BlockEditor <b>{eventName}</b> event called<hr>");
    }
    // Append element to event log
    private void AppendElement(string html)
    {
        EventLogEntries.Insert(0, html);
        StateHasChanged();
    }
    // Clear event log
    private void ClearLog(MouseEventArgs args)
    {
        EventLogEntries.Clear();
        StateHasChanged();
    }
}
<style>
    .blockeditor-events {
        width: 100%;
        margin: 0 auto;
    }
    .events-blockeditor .eventarea hr {
        margin-top: 0;
        margin-bottom: 0;
    }
        .blockeditor-events .e-mention.e-editable-element {
        border: unset;
    }
</style>