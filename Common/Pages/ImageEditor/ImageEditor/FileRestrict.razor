@page "/image-editor/file-restrict"

@using Syncfusion.Blazor.ImageEditor
@using Syncfusion.Blazor.Inputs
@using Syncfusion.Blazor.DropDowns
@using Syncfusion.Blazor.SplitButtons
@*Hidden:Lines*@
@inherits SampleBaseComponent
@*End:Hidden*@

<ActionDescription>
<p>This sample demonstrates file restriction in the <a href="https://www.syncfusion.com/blazor-components/blazor-wysiwyg-image-editor" target="_blank" rel="noopener" aria-label="Blazor Image Editor">Blazor Image Editor</a>. Use the property pane to configure allowed file extensions, minimum/maximum file sizes, and drag-and-drop behavior through the <b>UploadSettings</b> property.</p>
  <p>Dynamic updates from the UI instantly reflect in the component’s configuration, ensuring immediate validation feedback. This approach helps prevent large or unsupported uploads and streamlines user workflows.</p>
  <ul>
    <li><b>Allowed Extensions</b> – Choose from <code>.jpeg</code>, <code>.jpg</code>, <code>.png</code>, <code>.svg</code>, <code>.webp</code>, and <code>.bmp</code>.</li>
    <li><b>File Size</b> – Set minimum and maximum sizes (in bytes); defaults are 1 KB to 100 KB.</li>
    <li><b>Drag and Drop</b> – Configure drag-and-drop upload behavior to align with your UX needs.</li>
  </ul>
  <p>For setup guidance and additional configuration, see the <a href="https://blazor.syncfusion.com/documentation/image-editor/getting-started-with-web-app" target="_blank" rel="noopener" aria-label="Image Editor getting started documentation">documentation</a>.</p>
</ActionDescription>



<div class="control-section">
    <div style="text-align: center;">
        <div class="e-img-editor-dropdown-container">
            <label>Size As</label><br />
            <SfDropDownButton Content="@FileType" class="custom-dropdown-btn">
                <DropDownButtonEvents ItemSelected="ItemSelected"></DropDownButtonEvents>
                <DropDownMenuItems>
                    <DropDownMenuItem Text="MB" Id="MB" HtmlAttributes="@MbAttributes"></DropDownMenuItem>
                    <DropDownMenuItem Text="KB" Id="KB" HtmlAttributes="@KbAttributes"></DropDownMenuItem>
                </DropDownMenuItems>
            </SfDropDownButton>
        </div>
        <div class="e-img-editor-numeric-textbox-container">
            <label>Minimum Size</label><br />
            <SfNumericTextBox TValue="double" Width="150px" Min=1 @bind-Value="MinSize">
                <NumericTextBoxEvents TValue="double" ValueChange="@MinFileValueChange"></NumericTextBoxEvents>
            </SfNumericTextBox>
        </div>
        <div class="e-img-editor-numeric-textbox-container">
            <label>Maximum Size</label><br />
            <SfNumericTextBox TValue="double" Width="150px" Min=1 @bind-Value="@MaxSize">
                <NumericTextBoxEvents TValue="double" ValueChange="@MaxFileValueChange"></NumericTextBoxEvents>
            </SfNumericTextBox>
        </div>
        <div class="e-img-editor-dropdown-container">
            <label>Allowed Extensions</label><br />
            <SfMultiSelect TValue="string[]" Width="250px" ShowSelectAll="true" Mode="VisualMode.CheckBox" TItem="FileExtension" Placeholder="Select File Extensions"
                       @bind-Value="@SelectedExtensions" DataSource="@FileExtensionsList">
                <MultiSelectFieldSettings Text="Name" Value="Value"></MultiSelectFieldSettings>
                <MultiSelectEvents TItem="FileExtension" TValue="string[]" ValueChange="@UpdateAllowedFileExtensions"></MultiSelectEvents>
            </SfMultiSelect>
        </div>
    </div>
    <div class="e-img-editor-sample">
        <SfImageEditor @ref="ImageEditor" Height="500px">
            <ImageEditorEvents Created="UpdateFileSize"></ImageEditorEvents>
            <ImageEditorUploadSettings @ref="UploadSettings" MinFileSize="@MinFileSize" MaxFileSize="@MaxFileSize" AllowedExtensions="@AllowedExtensions"></ImageEditorUploadSettings>
        </SfImageEditor>
    </div>
</div>

@code {
    SfImageEditor? ImageEditor { get; set; }
    ImageEditorUploadSettings? UploadSettings;
    private string AllowedExtensions { get; set; } = ".jpeg, .jpg, .png, .svg, .webp, .bmp";
    private string[] SelectedExtensions { get; set; } = { "jpeg", "jpg", "png", "svg", "webp", "bmp" };
    private double MinSize { get; set; } = 1;
    private double MaxSize { get; set; } = 100;
    private double MinFileSize { get; set; } = 1; // 1KB default
    private double MaxFileSize { get; set; } = 100; // 100KB default
    private string FileType { get; set; } = "KB";
    private Dictionary<string, object>? MbAttributes;
    private Dictionary<string, object> KbAttributes = new Dictionary<string, object> { { "class", "e-selected" } };
    public class FileExtension
    {
        public string? Name { get; set; }
        public string? Value { get; set; }
    }
    private List<FileExtension> FileExtensionsList = new List<FileExtension>
    {
        new FileExtension { Name = "JPEG", Value = "jpeg" },
        new FileExtension { Name = "JPG", Value = "jpg" },
        new FileExtension { Name = "PNG", Value = "png" },
        new FileExtension { Name = "SVG", Value = "svg" },
        new FileExtension { Name = "WebP", Value = "webp" },
        new FileExtension { Name = "BMP", Value = "bmp" }
    };
    private async Task UpdateAllowedFileExtensions(MultiSelectChangeEventArgs<string[]> args)
    {
        if (args.Value is null || args.Value.Length == 0)
        {
            AllowedExtensions = ".jpeg, .jpg, .png, .svg, .webp, .bmp";
        }
        else
        {
            AllowedExtensions = string.Join(", ", args.Value);
        }
        await RefreshAsync();
    }
    private async Task MinFileValueChange(Syncfusion.Blazor.Inputs.ChangeEventArgs<double> args)
    {
        MinSize = args.Value;
        MinFileSize = ConvertToBytes(args.Value);
        await RefreshAsync();
    }
    private async Task MaxFileValueChange(Syncfusion.Blazor.Inputs.ChangeEventArgs<double> args)
    {
        MaxSize = args.Value;
        MaxFileSize = ConvertToBytes(args.Value);
        await RefreshAsync();
    }
    private async Task ItemSelected(MenuEventArgs args)
    {
        FileType = args.Item.Text;
        if (args.Item.Text == "MB")
        {
            MbAttributes = new Dictionary<string, object> { { "class", "e-selected" } };
            KbAttributes = new Dictionary<string, object>();
        }
        else
        {
            MbAttributes = new Dictionary<string, object>();
            KbAttributes = new Dictionary<string, object> { { "class", "e-selected" } };
        }
        UpdateFileSize();
        await RefreshAsync();
    }
    private void UpdateFileSize()
    {
        MinFileSize = ConvertToBytes(MinSize);
        MaxFileSize = ConvertToBytes(MaxSize);
    }
    private double ConvertToBytes(double value)
    {
        return value * (FileType == "MB" ? 1024 * 1024 : 1024);
    }
    private async Task RefreshAsync()
    {
        await Task.Delay(100);
        if (ImageEditor != null)
        {
            await ImageEditor.RefreshAsync();
        }
    }
}

<style>
    .e-image-editor {
        margin-top: 20px;
    }

    .e-img-editor-sample {
        height: 80vh;
        width: 100%;
        margin-top: 18px;
    }

    .e-img-editor-numeric-textbox-container,
    .e-img-editor-dropdown-container {
        display: inline-block;
        margin-right: 30px;
        text-align: left;
    }

    #dropdownbtn {
        font-weight: 400;
    }

    .material3 .custom-dropdown-btn,
    .material3-dark .custom-dropdown-btn {
        margin-top: 5px;
    }

    @@media only screen and (max-width: 700px) {
        .e-img-editor-dropdown-container,
        .e-img-editor-numeric-textbox-container {
            display: block;
            margin-right: 0;
            margin-bottom: 20px;
            text-align: center;
        }

        .e-img-editor-sample {
            height: 75vh;
            width: 100%;
        }
    }
</style>
