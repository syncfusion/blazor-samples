<Project Sdk="Microsoft.NET.Sdk.Web">

  <PropertyGroup>
    <TargetFramework>net9.0</TargetFramework>
	<DefineConstants>$(DefineConstants);WASM;STAGING</DefineConstants>
	<ErrorOnDuplicatePublishOutputFiles>false</ErrorOnDuplicatePublishOutputFiles>
	<RootNamespace>BlazorDemos</RootNamespace>
    <ImplicitUsings>disable</ImplicitUsings>
	<ShouldIncludeNativeSkiaSharp>True</ShouldIncludeNativeSkiaSharp>
	<SelfContained>true</SelfContained>
	<BlazorWebAssemblyLoadAllGlobalizationData>true</BlazorWebAssemblyLoadAllGlobalizationData>
	<Nullable>enable</Nullable>
	<WasmBuildNative>true</WasmBuildNative>
  </PropertyGroup>

  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Release|AnyCPU'">
	<DefineConstants>RELEASE;NET9_0;WASM;STAGING</DefineConstants>
	<ConfigurationValue>Release</ConfigurationValue>
	<Staging Condition="'$(DefineConstants)' != '' and $(DefineConstants.Contains('STAGING'))">true</Staging>
  </PropertyGroup>

   <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Debug|AnyCPU'">
		<DefineConstants>DEBUG;NET9_0;WASM;STAGING</DefineConstants>
		<ConfigurationValue>Debug</ConfigurationValue>
	</PropertyGroup>

	<PropertyGroup Condition="'$(ISSTAGING)' != ''">
		<DefineConstants>$(DefineConstants);ISSTAGING</DefineConstants>
	</PropertyGroup>

	<!-- Set AppEnvironment to Debug if Configuration is Debug OR STAGING is true -->
	<PropertyGroup Condition="'$(Configuration)' == 'Debug' Or '$(Staging)' == 'true'">
		<AppEnvironment>Debug</AppEnvironment>
	</PropertyGroup>

	<!-- Default to Release if AppEnvironment is not already set -->
	<PropertyGroup Condition="'$(AppEnvironment)' == ''">
		<AppEnvironment>Release</AppEnvironment>
	</PropertyGroup>

	<!-- Set AppEnvironment to Staging if Configuration is Release AND Staging is true -->
	<PropertyGroup Condition="'$(Configuration)' == 'Release' And '$(Staging)' == 'true'">
		<AppEnvironment>Staging</AppEnvironment>
	</PropertyGroup>
	
	<Target Name="RemoveStaticFiles" AfterTargets="AfterPublish">
		<PropertyGroup>
			<Files>$(PublishDir)\wwwroot\_content</Files>
		</PropertyGroup>

		<ItemGroup>
			<Directories Include="$(Files)\**"
				  Exclude="$(Files)\**\syncfusion-blazor.min.js;$(Files)\**\syncfusion-blazor.min.js.gz;$(Files)\**\syncfusion-blazor.min.js.br;$(Files)\Syncfusion.Blazor.Themes\**;$(Files)\Blazor_WASM_Common_NET9\**;
      $(Files)\**\syncfusion-blazor-base.min.js;$(Files)\**\syncfusion-blazor-base.min.js.gz;$(Files)\**\syncfusion-blazor-base.min.js.br;$(Files)\**\syncfusion-blazor-extended.min.js;$(Files)\**\syncfusion-blazor-extended.min.js.gz;$(Files)\**\syncfusion-blazor-extended.min.js.br;$(Files)\**\data.min.js;$(Files)\**\data.min.js.gz;$(Files)\**\data.min.js.br;$(Files)\**\diagrams.min.js;$(Files)\**\diagrams.min.js.gz;$(Files)\**\diagrams.min.js.br" />
		</ItemGroup>

		<Delete Files="@(Directories)" ContinueOnError="true" />
	</Target>


	<Target Name="MinifyAssets" BeforeTargets="BeforeBuild" Condition="'$(Configuration)'=='Release'">

		<ItemGroup>
			<_CssFiles Include="wwwroot/**/*.css" Exclude="wwwroot/**/*.min.css" />
			<_JsFiles Include="wwwroot/**/*.js" Exclude="wwwroot/**/*.min.js" />

			<_CssFiles Include="..\..\Common\wwwroot\**\*.css" Exclude="..\..\Common\wwwroot\**\*.min.css" />
			<_JsFiles Include="..\..\Common\wwwroot\**\*.js" Exclude="..\..\Common\wwwroot\**\*.min.js" />
		</ItemGroup>

		<Exec
		  Command="dotnet &quot;../../Common/AssetMinifier/Blazor-StaticAssetMinifier/AssetMinifier.dll&quot; &quot;%( _CssFiles.FullPath )&quot;"
		  Condition="Exists('%( _CssFiles.FullPath )')"
		  StandardOutputImportance="High"
		  StandardErrorImportance="High" />

		<Exec
		  Command="dotnet &quot;../../Common/AssetMinifier/Blazor-StaticAssetMinifier/AssetMinifier.dll&quot; &quot;%( _JsFiles.FullPath )&quot;"
		  Condition="Exists('%( _JsFiles.FullPath )')"
		  StandardOutputImportance="High"
		  StandardErrorImportance="High" />

	</Target>

	<Target Name="ProductionBuild" BeforeTargets="BeforeBuild">
		<Delete Files="wwwroot/version.js" />
		<WriteLinesToFile File="wwwroot/version.js" Lines='export const data={"version":"net9.0","configuration":"$(AppEnvironment)"}' />
	</Target>

  <ItemGroup>
    <ProjectReference Include="..\Blazor_WASM_Demos.Client\Blazor_WASM_Demos_NET9.Client.csproj" />
    <PackageReference Include="Microsoft.AspNetCore.Components.WebAssembly.Server" Version="9.0.8" />
  </ItemGroup>

	<ItemGroup>
		<Compile Remove="bin\**" />
		<Content Remove="bin\**" />
		<None Remove="bin\**" />
		<Compile Remove="obj\**" />
		<Content Remove="bin\**" />
		<None Remove="obj\**" />
	</ItemGroup>

	<ItemGroup>
		<Compile Remove="Pages\DocumentProcessing\Excel\EncryptAndDecryptService.cs" />
		<Compile Remove="Pages\DocumentProcessing\PDF\CompressExistingPdfService.cs" />
		<Compile Remove="Pages\DocumentProcessing\PDF\RedactionService.cs" />
	</ItemGroup>

	<ItemGroup>
		<Content Remove="Pages\DocumentProcessing\Excel\EncryptAndDecrypt.razor" />
		<Content Remove="Pages\DocumentProcessing\PDF\CompressExistingPdf.razor" />
		<Content Remove="Pages\DocumentProcessing\PDF\Redaction.razor" />
		<Content Remove="wwwroot\Blazor_WASM_Demos_NET8.lib.module.js" />
		<Content Remove="wwwroot\Blazor_WASM_Demos_NET10.lib.module.js" />
	</ItemGroup>

</Project>